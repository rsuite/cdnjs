var Gmail=function(e){var t;if(void 0!==e)t=e;else if("undefined"!=typeof jQuery)t=jQuery;else try{t=require("jquery")}catch(e){}var r={get:{},observe:{},check:{},tools:{},tracker:{},dom:{},chat:{},compose:{},helper:{get:{}},version:"0.6.4"};r.tracker.globals="undefined"!=typeof GLOBALS?GLOBALS:"undefined"!=typeof window&&null!==window.opener&&void 0!==window.opener.GLOBALS?window.opener.GLOBALS:[],r.tracker.view_data="undefined"!=typeof VIEW_DATA?VIEW_DATA:"undefined"!=typeof window&&null!==window.opener&&void 0!==window.opener.VIEW_DATA?window.opener.VIEW_DATA:[],r.tracker.ik=r.tracker.globals[9]||"",r.tracker.hangouts=void 0,r.get.last_active=function(){var e=r.tracker.globals[17][15];return{time:e[1],ip:e[3],mac_address:e[9],time_relative:e[10]}},r.get.loggedin_accounts=function(){var e,t,a,o=[],n=r.tracker.globals[17];for(e in n)if("mla"===(a=n[e])[0]){for(t in a[1])o.push({name:a[1][t][4],email:a[1][t][0],index:a[1][t][3]});return o}return o},r.get.user_email=function(){return r.tracker.globals[10]},r.get.manager_email=function(){return r.helper.get.is_delegated_inbox()?r.get.delegated_to_email():r.get.user_email()},r.get.delegated_to_email=function(){if(!r.helper.get.is_delegated_inbox())return null;var e,a,o=window.location.pathname,n=parseInt(o.substring(o.indexOf("/u/")+"/u/".length),10),i=r.get.loggedin_accounts();if(i&&i.length>0)for(e in i)if((a=i[e]).index===n)return a.email;return t(".gb_rb[href$='/u/"+n+"'] .gb_yb").text().split(" ")[0]},r.helper.get.is_locale=function(e){if(!e||"string"!=typeof e||e.length<2)return!1;if(e.match(/[0-9]/))return!1;var t=e.slice(0,2);return t.toLowerCase()===t||t.toUpperCase()===t},r.helper.filter_locale=function(e){return r.helper.get.is_locale(e)?e.substring(0,2).toLowerCase():null},r.helper.array_starts_with=function(e,t){return!!(e&&e.length>0&&e[0]===t)},r.helper.get.array_sublist=function(e,t){if(e)for(var a=0;a<e.length;a++){var o=e[a];if(r.helper.array_starts_with(o,t))return o}return null},r.helper.get.locale_from_url_params=function(e){if(e&&e.indexOf&&0===e.indexOf("https://")){var t=e.split("?");if(t.length>1)for(var r=t[1].split("&"),a=0;a<r.length;a++){var o=r[a].split("=");if(2===o.length&&"hl"===o[0])return o[1]}}return null},r.helper.get.locale_from_globals_item=function(e){if(!e)return null;for(var t=0;t<e.length;t++){var a=e[t],o=r.helper.get.locale_from_url_params(a);if(o)return o}return e[8]},r.get.localization=function(){var e=r.tracker.globals,t=r.helper.get.array_sublist(e[17],"ui");if(null!==t&&t.length>8){var a=r.helper.get.locale_from_globals_item(t);if(a=r.helper.filter_locale(a))return a}return null},r.check.is_thread=function(){var e=t(".nH .if").children(":eq(1)").children().children(":eq(1)").children(),a=r.get.email_ids();return e.length>1||a.length>1},r.dom.inbox_content=function(){return t("div[role=main]:first")},r.check.is_preview_pane=function(){var e=r.dom.inbox_content().find("[gh=tl]"),a=!1;return e.each(function(){t(this).hasClass("aia")&&(a=!0)}),a},r.check.is_multiple_inbox=function(){return r.dom.inboxes().length>1},r.check.is_horizontal_split=function(){return 0===r.dom.inbox_content().find("[gh=tl]").find(".nn").length},r.check.is_vertical_split=function(){return!1===r.check.is_horizontal_split()},r.check.is_tabbed_inbox=function(){return 1===t(".aKh").length},r.check.is_right_side_chat=function(){var e=t(".ApVoH");return 0!==e.length&&":wf"===e[0].getAttribute("aria-labelledby")},r.check.should_compose_fullscreen=function(){console.warn("gmail.js: This function is known to be unreliable, and may be deprecated in a future release.");var e=[];try{e=r.tracker.globals[17][4][1][32]}catch(t){e=["bx_scfs","false"]}return"true"===e[1]},r.check.is_google_apps_user=function(){var e=r.get.user_email();return-1===e.indexOf("gmail.com",e.length-"gmail.com".length)},r.get.storage_info=function(){var e=t(".md.mj").find("div")[0],r=t(e).find("span")[0].text,a=t(e).find("span")[1].text,o=100*parseFloat(r.replace(/[^0-9\.]/g,""))/parseFloat(a.replace(/[^0-9\.]/g,""));return{used:r,total:a,percent:Math.floor(o)}},r.dom.inboxes=function(){return r.dom.inbox_content().find("[gh=tl]")},r.dom.email_subject=function(){for(var e=t(".hP"),r=0;r<e.length;r++)if(t(e[r]).is(":visible"))return t(e[r]);return t()},r.get.email_subject=function(){return r.dom.email_subject().text()},r.dom.email_body=function(){return t(".nH.hx")},r.dom.toolbar=function(){for(var e=t("[gh='mtb']");1===t(e).children().length;)e=t(e).children().first();return e},r.dom.right_toolbar=function(){for(var e=t("[gh='tm'] [gh='s']").parent();1===t(e).children().length;)e=t(e).children().first();return e},r.check.is_inside_email=function(){if("email"!==r.get.current_page()&&!r.check.is_preview_pane())return!1;for(var e=t(".ii.gt .a3s.aXjCH"),a=[],o=0;o<e.length;o++){var n=e[o].getAttribute("class").split(" ")[2];"undefined"!==n&&void 0!==n&&a.push(e[o])}return a.length>0},r.check.is_plain_text=function(){for(var e=r.tracker.globals[17][4][1],t=0;t<e.length;t++){var a=e[t];if("bx_cm"===a[0])return"0"===a[1]}return!1},r.dom.email_contents=function(){for(var e=t(".ii.gt div.a3s.aXjCH"),r=[],a=0;a<e.length;a++){var o=e[a].getAttribute("class").split(" ")[2],n=e[a].getAttribute("contenteditable");"undefined"!==o&&void 0!==o&&"true"!==n&&r.push(e[a])}return r},r.get.email_ids=function(){if(r.check.is_inside_email()){var e=r.get.email_data();return Object.keys(e.threads)}return[]},r.get.compose_ids=function(){for(var e=[],r=t(".M9 [name=draft]"),a=0;a<r.length;a++)"undefined"!==r[a].value&&e.push(r[a].value);return e},r.get.thread_id=function(){const e=document.querySelector("h2[data-legacy-thread-id]");return null!==e?e.dataset.legacyThreadId:void 0},r.get.email_id=function(){return console.warn("GmailJS: api.get.email_id() invoked. Please note this function actually returns thread-id, and that email-id and thread-id may not always be used interchangably! Use api.get.thread_id() instead to silence this warning."),r.get.thread_id()},r.check.is_priority_inbox=function(){return t(".qh").length>0},r.check.is_rapportive_installed=function(){return 1===t("#rapportive-sidebar").length},r.check.is_streak_installed=function(){return t("[id^='bentoBox'],[id*=' bentoBox'],[class*=' bentoBox'],[class*='bentoBox']").length>0},r.check.is_anydo_installed=function(){return t("[id^='anydo'],[id*=' anydo'],[class*=' anydo'],[class*='anydo']").length>0},r.check.is_boomerang_installed=function(){return t("[id^='b4g_'],[id*=' b4g_'],[class*=' b4g_'],[class*='b4g_']").length>0},r.check.is_xobni_installed=function(){return t("#xobni_frame").length>0},r.check.is_signal_installed=function(){return t("[id^='Signal'],[id*=' Signal'],[class*=' signal'],[class*='signal']").length>0},r.check.are_shortcuts_enabled=function(){for(var e=void 0,t=!0,a=r.tracker.globals[17][4][1],o=0;o<a.length;o++){var n=a[o];if("bx_hs"===n[0]){e=n[1];break}}if(void 0!==e){t={0:!0,1:!1}[e]}return t},r.dom.get_left_sidebar_links=function(){return t("div[role=navigation] [title]")},r.dom.search_bar=function(){return t("[gh=sb]")},r.get.search_query=function(){return r.dom.search_bar().find("input")[0].value},r.get.unread_inbox_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("inbox")+"']");return e.length>0&&-1!==e[0].text.indexOf("(")?parseInt(e[0].text.split(":")[0].replace(/[^0-9]/g,"")):0},r.get.unread_draft_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("drafts")+"']");return e.length>0&&-1!==e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_spam_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("spam")+"']");return e.length>0&&-1!==e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_forum_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("forums")+"']");return e.length>0&&-1!==e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_update_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("updates")+"']");return e.length>0&&-1!==e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_promotion_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("promotions")+"']");return e.length>0&&-1!==e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.unread_social_emails=function(){var e=t("div[role=navigation]").find("[title*='"+r.tools.i18n("social_updates")+"']");return e.length>0&&-1!==e[0].text.indexOf("(")?parseInt(e[0].text.replace(/[^0-9]/g,"")):0},r.get.beta=function(){return{new_nav_bar:0===t("#gbz").length}},r.get.unread_emails=function(){return{inbox:r.get.unread_inbox_emails(),drafts:r.get.unread_draft_emails(),spam:r.get.unread_spam_emails(),forum:r.get.unread_forum_emails(),update:r.get.unread_update_emails(),promotions:r.get.unread_promotion_emails(),social:r.get.unread_social_emails()}},r.tools.error=function(e){if(!console)throw e;console.error(e)},r.tools.parse_url=function(e){for(var t=/[?&]([^=#]+)=([^&#]*)/g,r={},a=t.exec(e);a;)r[a[1]]=a[2],a=t.exec(e);return r},r.tools.sleep=function(e){for(var t=(new Date).getTime();!((new Date).getTime()-t>e););},r.tools.multitry=function(e,t,a,o,n,i){if(void 0!==n&&n>=t)return i;n=void 0===n?0:n;var s=a();if(o(s))return s;r.tools.sleep(e),r.tools.multitry(e,t,a,o,n+1,s)},r.tools.deparam=function(e,t){var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a={},o={true:!0,false:!1,null:null};return function(e,t){for(var r=[],a=0;a<e.length;a++)r.push(t(e[a]))}(e.replace(/\+/g," ").split("&"),function(e,n){var i,s=e.split("="),l=decodeURIComponent(s[0]),c=a,d=0,u=l.split("]["),m=u.length-1;if(/\[/.test(u[0])&&/\]$/.test(u[m])?(u[m]=u[m].replace(/\]$/,""),m=(u=u.shift().split("[").concat(u)).length-1):m=0,2===s.length)if(i=decodeURIComponent(s[1]),t&&(i=i&&!isNaN(i)?+i:"undefined"===i?void 0:void 0!==o[i]?o[i]:i),m)for(;d<=m;d++)c=c[l=""===u[d]?c.length:u[d]]=d<m?c[l]||(u[d+1]&&isNaN(u[d+1])?{}:[]):i;else r(a[l])?a[l].push(i):void 0!==a[l]?a[l]=[a[l],i]:a[l]=i;else l&&(a[l]=t?void 0:"")}),a},r.tools.parse_actions=function(e,t){if("fup"===e.url.act||"fuv"===e.url.act||e.body_is_object)return!(!e.body_is_object||!r.observe.bound("upload_attachment"))&&{upload_attachment:[e.body_params]};e.url.search;var a={},o={tae:"add_to_tasks","rc_^i":"archive",tr:"delete",dm:"delete_message_in_thread",dl:"delete_forever",dc_:"delete_label",dr:"discard_draft",el:"expand_categories",cffm:"filter_messages_like_these",arl:"label",mai:"mark_as_important",mani:"mark_as_not_important",us:"mark_as_not_spam",sp:"mark_as_spam",mt:"move_label",ib:"move_to_inbox",ig:"mute",rd:"read",sd:"save_draft",sm:"send_message",mo:"show_newly_arrived_message",st:"star",cs:"undo_send",ug:"unmute",ur:"unread",xst:"unstar",new_mail:"new_email",poll:"poll",refresh:"refresh",rtr:"restore_message_in_thread",open_email:"open_email",toggle_threads:"toggle_threads"};"string"==typeof e.url.ik&&(r.tracker.ik=e.url.ik),"string"==typeof e.url.at&&(r.tracker.at=e.url.at),"string"==typeof e.url.rid&&-1!==e.url.rid.indexOf("mail")&&(r.tracker.rid=e.url.rid);var n=decodeURIComponent(e.url.act),i=e.body_params,s="string"==typeof i.t?[i.t]:i.t,l=null;switch(n){case"cs":case"ur":case"rd":case"tr":case"sp":case"us":case"ib":case"dl":case"st":case"xst":case"mai":case"mani":case"ig":case"ug":case"dr":case"mt":case"cffm":case"rc_^i":l=[s,e.url,e.body];break;case"arl":case"dc_":l=[s,e.url,e.body,e.url.acn];break;case"sd":l=[s,e.url,i];break;case"tae":case"sm":l=[e.url,e.body,i];break;case"el":l=[e.url,e.body,"1"===i.ex];break;case"dm":case"rtr":case"mo":l=[i.m,e.url,e.body]}return"string"==typeof e.url._reqid&&"tl"===e.url.view&&void 0!==e.url.auto&&(l=[e.url.th,e.url,e.body],r.observe.bound("new_email")&&(a.new_email=l)),"cv"!==e.url.view&&"ad"!==e.url.view||"string"!=typeof e.url.th||"string"!=typeof e.url.search||void 0!==e.url.rid||(l=[e.url.th,e.url,e.body],r.observe.bound("open_email")&&(a.open_email=l)),"cv"!==e.url.view&&"ad"!==e.url.view||"object"!=typeof e.url.th||"string"!=typeof e.url.search||void 0===e.url.rid||(l=[e.url.th,e.url,e.body],r.observe.bound("toggle_threads")&&(a.toggle_threads=l)),"cv"!==e.url.view&&"ad"!==e.url.view||"string"!=typeof e.url.th||"string"!=typeof e.url.search||void 0===e.url.rid||void 0!==e.url.msgs&&(l=[e.url.th,e.url,e.body],r.observe.bound("toggle_threads")&&(a.toggle_threads=l)),"string"==typeof e.url.SID&&"string"==typeof e.url.zx&&-1!==e.body.indexOf("req0_")&&(r.tracker.SID=e.url.SID,l=[e.url,e.body,i],r.observe.bound("poll")&&(a.poll=l)),"string"==typeof e.url.ik&&"string"==typeof e.url.search&&0===e.body.length&&"string"==typeof e.url._reqid&&(l=[e.url,e.body,i],r.observe.bound("refresh")&&(a.refresh=l)),l&&o[n]&&r.observe.bound(o[n])&&(a[o[n]]=l),"POST"!==e.method||"string"!=typeof e.url.SID&&"string"!=typeof e.url.ik&&"string"!=typeof e.url.act||(a.http_event=[e]),a},r.tools.parse_response=function(e){var t,r,a,o=[];try{for(e=(e=e.replace(/\n/g," ")).substring(e.indexOf("'")+1,e.length);e.replace(/\s/g,"").length>1;){(r=e.substring(0,e.indexOf("[")).replace(/\s/g,""))||(r=e.length),a=parseInt(r,10)-2+e.indexOf("["),t=e.substring(e.indexOf("["),a);var n=JSON.parse(t);o.push(n),e=(e=e.substring(e.indexOf("["),e.length)).substring(t.length,e.length)}}catch(e){console.log("Gmail post response parsing failed.",e)}return o},r.tools.parse_attachment_url=function(e){var t=e.split(":");return{type:t[0],url:t[2]+":"+t[3]}};var a=function(e,t){for(var r in t)e[r]=t[r]},o=function(e,t){for(var r=0;r<t.length;r++){var a=t[r];e.push(a)}return e};r.tools.parse_requests=function(e,t){e.url_raw=e.url,e.url=r.tools.parse_url(e.url),"object"==typeof e.body?(e.body_params=e.body,e.body_is_object=!0):e.body_params=r.tools.deparam(e.body),"object"!=typeof r.tracker.events&&"object"!=typeof r.tracker.actions&&(r.tracker.events=[],r.tracker.actions=[]),r.tracker.events.unshift(e);var a=r.tools.parse_actions(e,t);return"POST"===e.method&&"string"==typeof e.url.act&&r.tracker.actions.unshift(e),r.tracker.events.length>50&&r.tracker.events.pop(),r.tracker.actions.length>10&&r.tracker.actions.pop(),a},r.tools.patch=function(e,t){t(e)},r.tools.xhr_watcher=function(){if(r.tracker.xhr_init)return;r.tracker.xhr_init=!0;const e=r.helper.get_xhr_window();r.tools.patch(e.XMLHttpRequest.prototype.open,t=>{e.XMLHttpRequest.prototype.open=function(e,r,a,o,n){var i=t.apply(this,arguments);return this.xhrParams={method:e.toString(),url:r.toString()},i}}),r.tools.patch(e.XMLHttpRequest.prototype.send,a=>{e.XMLHttpRequest.prototype.send=function(e){var o=!1;if(this.xhrParams&&(this.xhrParams.body=e,o=r.tools.parse_requests(this.xhrParams,this)),r.observe.trigger("before",o,this)&&(e=arguments[0]=this.xhrParams.body_is_object?this.xhrParams.body_params:t.param(this.xhrParams.body_params,!0).replace(/\+/g,"%20")),r.observe.bound(o,"after")){var n=this.onreadystatechange,i=this;this.onreadystatechange=function(e){this.readyState===this.DONE&&(i.xhrResponse=r.tools.parse_response(e.target.responseText),r.observe.trigger("after",o,i)),n&&n.apply(this,arguments)}}var s=a.apply(this,arguments);return r.observe.trigger("on",o,this),s}})},r.helper.get_xhr_window=function(){var e=null;return top.document.getElementById("js_frame")?e=top.document.getElementById("js_frame"):window.opener&&(e=window.opener.top.document.getElementById("js_frame")),e||(e=window.opener?window.opener.top:top),e.contentDocument?e.contentDocument.defaultView:e},r.observe.http_requests=function(){return r.tracker.events},r.observe.actions=function(){return r.tracker.actions},r.observe.bind=function(e,t,a){"object"!=typeof r.tracker.watchdog&&(r.tracker.watchdog={before:{},on:{},after:{},dom:{}},r.tracker.bound={}),"object"!=typeof r.tracker.watchdog[e]&&r.tools.error("api.observe.bind called with invalid type: "+e),"dom"!==e&&r.tools.xhr_watcher(),"object"!=typeof r.tracker.watchdog[e][t]&&(r.tracker.watchdog[e][t]=[]),r.tracker.watchdog[e][t].push(a),r.tracker.bound[t]=void 0===r.tracker.bound[t]?1:r.tracker.bound[t]+1,r.tracker.bound[e]=void 0===r.tracker.bound[e]?1:r.tracker.bound[e]+1},r.observe.on=function(e,t,a){if(r.observe.on_dom(e,t))return!0;r.observe.bind("on",e,t),a&&r.observe.after(e,t)},r.observe.before=function(e,t){r.observe.bind("before",e,t)},r.observe.after=function(e,t){r.observe.bind("after",e,t)},r.observe.bound=function(e,a){if("object"!=typeof r.tracker.watchdog)return!1;if(e){if("object"==typeof e){var o=!1;return t.each(e,function(e,t){"object"==typeof r.tracker.watchdog[a][e]&&(o=!0)}),o}return a?"object"==typeof r.tracker.watchdog[a][e]:r.tracker.bound[e]>0}if(a)return r.tracker.bound[a]>0;r.tools.error("api.observe.bound called with invalid args")},r.observe.off=function(e,a){if("object"!=typeof r.tracker.watchdog)return!0;var o=a?[a]:["before","on","after","dom"];t.each(o,function(a,o){if("object"!=typeof r.tracker.watchdog[o])return!0;e?"object"==typeof r.tracker.watchdog[o][e]&&(r.tracker.bound[e]-=r.tracker.watchdog[o][e].length,r.tracker.bound[o]-=r.tracker.watchdog[o][e].length,delete r.tracker.watchdog[o][e]):t.each(r.tracker.watchdog[o],function(e,t){"object"==typeof r.tracker.watchdog[o][e]&&(r.tracker.bound[e]-=r.tracker.watchdog[o][e].length,r.tracker.bound[o]-=r.tracker.watchdog[o][e].length,delete r.tracker.watchdog[o][e])})})},r.observe.trigger=function(e,a,o){if(!a)return!1;var n=!1;return t.each(a,function(a,i){i=t.extend([],i),"after"===e&&i.push(o.xhrResponse),i.push(o),r.observe.bound(a,e)&&(n=!0,t.each(r.tracker.watchdog[e][a],function(e,t){t.apply(void 0,i)}))}),n},r.observe.trigger_dom=function(e,a,o){o||(o=function(e,t){t(e)}),r.tracker.watchdog.dom[e]&&t.each(r.tracker.watchdog.dom[e],function(e,t){o(a,t)})},r.observe.initialize_dom_observers=function(){r.tracker.dom_observer_init=!0,r.tracker.supported_observers=["view_thread","view_email","load_email_menu","recipient_change","compose"],r.tracker.dom_observers={view_thread:{class:["Bu","nH"],sub_selector:"div.if",handler:function(e,t){t(e=new r.dom.thread(e));var a=e.dom("opened_email");a.length&&r.observe.trigger_dom("view_email",a,r.tracker.dom_observers.view_thread.sub_observers.view_email.handler)},sub_observers:{view_email:{class:"",sub_selector:"div.adn",handler:function(e,t){t(e=new r.dom.email(e))}},load_email_menu:{class:"J-N",selector:"div[role=menu] div[role=menuitem]:first-child",handler:function(e,t){t(e=e.closest("div[role=menu]"))}}}},recipient_change:{class:"vR",handler:function(e,t){"object"!=typeof r.tracker.recipient_matches&&(r.tracker.recipient_matches=[]),r.tracker.recipient_matches.push(e),setTimeout(function(){if(r.tracker.recipient_matches.length){var e=new r.dom.compose(r.tracker.recipient_matches[0].closest("div.M9")),a=e.recipients();t(e,a,r.tracker.recipient_matches),r.tracker.recipient_matches=[]}},100)}},compose:{class:"An",handler:function(e,t){var a=e;if((e=e.closest("div.M9")).length){var o;if((e=new r.dom.compose(e)).is_inline())o=0===e.find("input[name=subject]").val().indexOf("Fw")?"forward":"reply";else o="compose",a.closest("div.AD").find(".Ha").mouseup(function(){return r.tracker.composeCancelledCallback&&r.tracker.composeCancelledCallback(e),!0});t(e,o)}}}},r.tracker.custom_supported_observers&&(t.merge(r.tracker.supported_observers,r.tracker.custom_supported_observers),t.extend(!0,r.tracker.dom_observers,r.tracker.custom_dom_observers)),r.tracker.dom_observer_map={},t.each(r.tracker.dom_observers,function(e,a){t.isArray(a.class)||(a.class=[a.class]),t.each(a.class,function(t,a){r.tracker.dom_observer_map[a]=e})})},r.observe.register=function(e,a,o){r.tracker.dom_observer_init&&r.tools.error("Error: Please register all custom DOM observers before binding handlers using gmail.observe.on etc"),r.tracker.custom_supported_observers||(r.tracker.custom_supported_observers=[],r.tracker.custom_dom_observers={});var n={};"object"!=typeof a||t.isArray(a)?n.class=a:t.each(["class","selector","sub_selector","handler"],function(e,t){a[t]&&(n[t]=a[t])}),r.tracker.custom_supported_observers.push(e),o?(r.tracker.custom_dom_observers[o]||(r.tracker.custom_dom_observers[o]={sub_observers:{}}),r.tracker.custom_dom_observers[o].sub_observers[e]=n):r.tracker.custom_dom_observers[e]=n},r.observe.on_dom=function(e,a){if(r.tracker.dom_observer_init||r.observe.initialize_dom_observers(),t.inArray(e,r.tracker.supported_observers)>-1){if(!r.tracker.observing_dom)r.tracker.observing_dom=!0,t(window.document).bind("DOMNodeInserted",function(e){r.tools.insertion_observer(e.target,r.tracker.dom_observers,r.tracker.dom_observer_map)}),new MutationObserver(function(e){for(var a=0;a<e.length;a++)for(var o=e[a],n=o.removedNodes,i=0;i<n.length;i++){if("vR"===n[i].className){var s=r.tracker.dom_observer_map.vR,l=r.tracker.dom_observers.recipient_change.handler;r.observe.trigger_dom(s,t(o.target),l)}}}).observe(document.body,{subtree:!0,childList:!0});return r.observe.bind("dom",e,a),!0}if("compose_cancelled"===e)console.log("set compose cancelled callback"),r.tracker.composeCancelledCallback=a;else if("load"===e){if(r.dom.inbox_content().length)return a();var o=0,n=setInterval(function(){if(r.dom.inbox_content().length>0)return clearInterval(n),a();++o>50&&(clearInterval(n),console.log("Failed to detect interface load in 10 seconds. Will automatically fire event in 5 further seconds."),setTimeout(a,5e3))},200);return!0}},r.tools.insertion_observer=function(e,a,o,n){if(r.tracker.dom_observer_map){var i=e.className||"",s=i.trim?i.trim().split(/\s+/):[];s.length||s.push(""),t.each(s,function(n,i){var s=o[i];if(s&&r.tracker.watchdog.dom[s]){var l=t(e),c=a[s];if(c.selector&&!l.is(c.selector))return;if(c.sub_selector&&(l=l.find(c.sub_selector)),l.length){var d=c.handler?c.handler:function(e,t){t(e)};if(r.observe.trigger_dom(s,l,d),c.sub_observers){var u={};t.each(c.sub_observers,function(e,t){u[t.class]=e}),l.bind("DOMNodeInserted",function(e){r.tools.insertion_observer(e.target,c.sub_observers,u,"SUB ")})}}}})}},r.tools.make_request=function(e,r,a){var o=decodeURIComponent(e.replace(/%23/g,"#-#-#")),n={type:r=r||"GET",url:o=encodeURI(o).replace(/#-#-#/gi,"%23"),async:!1,dataType:"text"};return a&&(n.cache=!1),t.ajax(n).responseText},r.tools.make_request_async=function(e,r,a,o,n){var i=decodeURIComponent(e.replace(/%23/g,"#-#-#")),s={type:r=r||"GET",url:i=encodeURI(i).replace(/#-#-#/gi,"%23"),async:!0,dataType:"text"};n&&(s.cache=!1),t.ajax(s).done(function(e,t,r){a(r.responseText)}).fail(function(e,t,r){console.error("Request Failed",r),"function"==typeof o&&o(e,t,r)})},r.tools.make_request_download_promise=function(e,t){const r=Date.now();e+="&cacheCounter="+r;let a="text";return t&&(a="arraybuffer"),new Promise((r,o)=>{const n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType=a,n.onreadystatechange=(()=>{if(n.readyState===XMLHttpRequest.DONE&&n.status>=200&&n.status<=302){const e=n.response;if(e)if(t){const t=new Uint8Array(e);r(t)}else r(e)}}),n.onerror=(e=>{o(e)}),n.send()})},r.tools.parse_view_data=function(e){for(var t=[],r=[],a=0;a<e.length;a++)if("tb"===e[a][0])for(var o=0;o<e[a][2].length;o++)r.push(e[a][2][o]);for(var n=0;n<r.length;n++){var i=r[n];t.push({id:i[0],title:i[9],excerpt:i[10],time:i[15],sender:i[28],attachment:i[13],labels:i[5]})}return t},r.helper.get.is_delegated_inbox=function(){return 1===t(".identityUserDelegatedAccount").length},r.helper.get.visible_emails_pre=function(){var e=r.get.current_page(),a=window.location.origin+window.location.pathname+"?ui=2&ik="+r.tracker.ik+"&rid="+r.tracker.rid+"&view=tl&num=120&rt=1",o=t(".aqK:visible .Dj").find("span:first").text().replace(",","").replace(".","").split("–")[0];a+=o?"&start="+(o=parseInt(o-1))+"&sstart="+o:"&start=0";var n="";if(0===e.indexOf("label/"))a+="&cat="+e.split("/")[1]+"&search=cat";else if(0===e.indexOf("category/"))-1!==e.indexOf("forums")?n="group":-1!==e.indexOf("updates")?n="notification":-1!==e.indexOf("promotion")?n="promo":-1!==e.indexOf("social")&&(n="social"),a+="&cat=^smartlabel_"+n+"&search=category";else if(0===e.indexOf("search/")){var i=t("input[name=at]").val();a+="&qs=true&q="+e.split("/")[1]+"&at="+i+"&search=query"}else"inbox"===e?"true"===t("div[aria-label='Social']").attr("aria-selected")?a+="&cat=^smartlabel_"+(n="social")+"&search=category":"true"===t("div[aria-label='Promotions']").attr("aria-selected")?a+="&cat=^smartlabel_"+(n="promo")+"&search=category":"true"===t("div[aria-label='Updates']").attr("aria-selected")?a+="&cat=^smartlabel_"+(n="notification")+"&search=category":"true"===t("div[aria-label='Forums']").attr("aria-selected")?a+="&cat=^smartlabel_"+(n="group")+"&search=category":r.check.is_google_apps_user()?a+="&search=inbox":a+="&search=mbox":a+="&search="+e;return a},r.helper.get.visible_emails_post=function(e){var t=[];if(!e)return t;var a=e.substring(e.indexOf("["),e.length),n=JSON.parse(a);for(var i in r.tracker.view_data=n,r.tracker.view_data)if("function"!=typeof r.tracker.view_data[i]){var s=r.tools.parse_view_data(r.tracker.view_data[i]);s.length>0&&o(t,s)}return t},r.helper.trigger_mouse_click=function(e){if(e){var t=document.createEvent("MouseEvents");t.initEvent("mousedown",!0,!1),e.dispatchEvent(t);var r=document.createEvent("MouseEvents");return r.initEvent("mouseup",!0,!1),e.dispatchEvent(r),!0}return!1},r.get.visible_emails=function(){var e=r.helper.get.visible_emails_pre(),t=r.tools.make_request(e);return r.helper.get.visible_emails_post(t)},r.get.visible_emails_async=function(e){var t=r.helper.get.visible_emails_pre();r.tools.make_request_async(t,"GET",function(t){var a=r.helper.get.visible_emails_post(t);e(a)})},r.get.selected_emails_data=function(){var e=[];if(r.check.is_inside_email())e.push(r.get.email_data());else if(t("[gh='tl'] div[role='checkbox'][aria-checked='true']").length){var a=null,o=r.get.visible_emails();t("[gh='tl'] div[role='checkbox']").each(function(n){"true"===t(this).attr("aria-checked")&&(a=r.get.email_data(o[n].id),e.push(a))})}return e},r.get.current_page=function(e){var t=(e=e||window.location.hash).split("#").pop().split("?").shift()||"inbox";if(t.match(/\/[0-9a-zA-Z]{16,}$/gi))return"email";if(0===t.indexOf("search/")||0===t.indexOf("category/")||0===t.indexOf("label/")){var r=t.split("/");return r[0]+"/"+r[1]}return t.split("/").shift()},r.tools.infobox=function(e,r,a){var o=t(".b8.UC");if(o.length>0){o.stop(!1,!0);var n=o.find(".vh");if(a?n.html(e):n.text(e),void 0!==r){var i=o.attr("style");o.removeAttr("style").fadeTo(r,0,function(){t(this).attr("style",i)})}else o.removeAttr("style")}},r.tools.rerender=function(e){var t,r=window.location.href;t=-1!==window.location.hash.indexOf("/")?r.replace(/#.*?\//,"#/"):r.replace(/#.*/,"#"),window.location.replace(t),setTimeout(function(){window.location.replace(r),window.history.back(),e&&e()},0)},r.tools.get_reply_to=function(e){var t=e?e[4]:[];return 0!==t.length?r.tools.extract_email_address(t[0]):null},r.tools.parse_attachment_data=function(e){if(!e[7]||!e[7][0])return null;var t="";"undefined"!=typeof window&&(t=window.location.origin+window.location.pathname);var a=e[7][0];r.tracker.attachment_data=a;for(var o=[],n=0;n<a.length;n++){var i=a[n];o.push({attachment_id:i[0],name:i[1],type:i[2],size:i[3],url:t+i[9]})}return o},r.tools.parse_email_data=function(e){var a={};for(var o in e){var n=e[o];if("cs"===n[0]&&(a.thread_id=n[1],a.first_email=n[8][0],a.last_email=n[2],a.total_emails=n[3],a.total_threads=n[8],a.people_involved=n[15],a.subject=n[23]),"ms"===n[0]){void 0===a.threads&&(a.threads={}),a.threads[n[1]]={},a.threads[n[1]].is_deleted=n[9]&&n[9].indexOf("^k")>-1,a.threads[n[1]].reply_to_id=n[2],a.threads[n[1]].from=n[5],a.threads[n[1]].from_email=n[6],a.threads[n[1]].timestamp=n[7],a.threads[n[1]].datetime=n[24],a.threads[n[1]].attachments=n[21].split(","),a.threads[n[1]].attachments_details=n[13]?r.tools.parse_attachment_data(n[13]):null,a.threads[n[1]].subject=n[12],a.threads[n[1]].content_html=n[13]?n[13][6]:n[8],a.threads[n[1]].to=n[13]?n[13][1]:void 0!==n[37]?n[37][1]:[],a.threads[n[1]].cc=n[13]?n[13][2]:[],a.threads[n[1]].bcc=n[13]?n[13][3]:[],a.threads[n[1]].reply_to=r.tools.get_reply_to(n[13]),a.threads[n[1]].labels=n[9];try{a.threads[n[1]].content_plain=n[13]?t(n[13][6]).text():n[8]}catch(e){a.threads[n[1]].content_plain=n[13]?n[13][6]:n[8]}}}return a},r.helper.get.email_data_pre=function(e){r.check.is_inside_email()&&void 0===e&&(e=r.get.thread_id());var t=null;return void 0!==e&&(t=window.location.origin+window.location.pathname+"?ui=2&ik="+r.tracker.ik+"&rid="+r.tracker.rid+"&view=cv&th="+e+"&msgs=&mb=0&rt=1&search=inbox"),t},r.helper.get.email_data_post=function(e){if(!e)return{};var t=e.substring(e.indexOf("["),e.length),a=JSON.parse(t);return r.tracker.email_data=a[0],r.tools.parse_email_data(r.tracker.email_data)},r.get.email_data=function(e){var t=r.helper.get.email_data_pre(e);if(null!==t){var a=r.tools.make_request(t);return r.helper.get.email_data_post(a)}return{}},r.get.email_data_async=function(e,t){var a=r.helper.get.email_data_pre(e);null!==a?r.tools.make_request_async(a,"GET",function(e){var a=r.helper.get.email_data_post(e);t(a)}):t({})},r.helper.get.email_source_pre=function(e){return!e&&r.check.is_inside_email()&&(e=r.get.email_id()),e?window.location.origin+window.location.pathname+"?view=att&th="+e+"&attid=0&disp=comp&safe=1&zw":null},r.get.email_source=function(e){console.warn("Gmail.js: This function has been deprecated and will be removed in an upcoming release! Please migrate to email_source_async!");var t=r.helper.get.email_source_pre(e);return null!==t?r.tools.make_request(t,"GET",!0):""},r.get.email_source_async=function(e,t,a,o){r.get.email_source_promise(e,o).then(t).catch(a)},r.get.email_source_promise=function(e,t){const a=r.helper.get.email_source_pre(e);return null!==a?r.tools.make_request_download_promise(a,t):new Promise((e,t)=>{t("Unable to resolve URL for email source!")})},r.get.displayed_email_data=function(){var e=r.get.email_data();return r.check.is_conversation_view()?n(e):i(e)},r.get.displayed_email_data_async=function(e){r.get.email_data_async(void 0,function(t){r.check.is_conversation_view()?e(n(t)):e(i(t))})};var n=function(e){var t=e,r=t.threads,a=t.total_threads,o=0===(window.location.hash.split("#")[1]||"").indexOf("trash");for(var n in r){var i=r[n];(o?i.is_deleted:!i.is_deleted)||(delete r[n],a.splice(a.indexOf(n),1),t.total_emails--)}return t},i=function(e){var a={};for(var o in e.threads){if(t(".ii.gt .a3s.aXjCH."+("m"+o)).length>0){var n=e.threads[o];a.first_email=o,a.last_email=o,a.subject=e.subject,a.threads={},a.threads[o]=n,a.total_emails=1,a.total_threads=[o],a.people_involved=[],a.people_involved.push([n.from,n.from_email]),n.to.forEach(function(e){var t=r.tools.extract_email_address(e),o=r.tools.extract_name(e.replace(t,""))||"";a.people_involved.push([o,t])});break}}return a};r.check.is_conversation_view=function(){for(var e=void 0,t=r.tracker.globals[17][4][1],a=0;a<t.length;a++){var o=t[a];if("bx_vmb"===o[0]){e=o[1];break}}return"0"===e||void 0===e},r.tools.extract_email_address=function(e){var t=e?e.match(/[\+a-z0-9._-]+@[a-z0-9._-]+\.[a-z0-9._-]+/gi):void 0;return t?t[0]:void 0},r.tools.extract_name=function(e){var t=e?e.match(/[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF"._\s-]+/gi):void 0;return t&&t[0]?t[0].trim():void 0},r.tools.i18n=function(e){var t;switch(r.get.localization()){case"fr":t={inbox:"Boîte de réception",drafts:"Brouillons",spam:"Spam",forums:"Forums",updates:"Mises à jour",promotions:"Promotions",social_updates:"Réseaux sociaux"};break;case"nl":t={inbox:"Postvak IN",drafts:"Concepten",spam:"Spam",forums:"Forums",updates:"Updates",promotions:"Reclame",social_updates:"Sociaal"};break;case"en":default:t={inbox:"Inbox",drafts:"Drafts",spam:"Spam",forums:"Forums",updates:"Updates",promotions:"Promotions",social_updates:"Social Updates"}}return t[e]};var s=function(e,r,a,o,n,i){var s=t(document.createElement("div"));s.attr("class","G-Ni J-J5-Ji");var l=t(document.createElement("div")),c="T-I J-J5-Ji ";return c+=null!=n&&""!==n?a+n:a+o,l.attr("class",c),l.html(e),l.click(r),t(document.createElement("div")).attr("class","asa"),s.html(l),i.append(s),s};return r.tools.add_toolbar_button=function(e,t,a){return s(e,t,"lS ","T-I-ax7 ar7",a,r.dom.toolbar())},r.tools.add_right_toolbar_button=function(e,t,a){return s(e,t,"ash ","T-I-ax7 L3",a,r.dom.right_toolbar())},r.tools.add_compose_button=function(e,r,a,o){var n=t(document.createElement("div")),i="T-I J-J5-Ji aoO L3 ";return void 0!==o&&(i+=o),n.attr("class",i),n.html(r),n.click(a),e.find(".gU.Up  > .J-J5-Ji").append(n),n},r.tools.add_attachment_button=function(e,r,a,o,n){var i=t(document.createElement("div"));i.attr("class","T-I J-J5-Ji aQv T-I-ax7 L3"),i.attr("style","user-select: none;"),i.attr("aria-label",o),i.attr("data-tooltip",o);i.mouseover(function(){this.classList.add("T-I-JW")}),i.mouseout(function(){this.classList.remove("T-I-JW")});var s=t(document.createElement("div")),l="wtScjd J-J5-Ji aYr";return a&&(l+=" "+a),s.attr("class",l),r&&s.html(r),i.append(s),i.click(n),e.$el.find("div.aQw").append(i),i},r.tools.remove_modal_window=function(){t("#gmailJsModalBackground").remove(),t("#gmailJsModalWindow").remove()},r.tools.add_modal_window=function(e,a,o,n,i){i=i||r.tools.remove_modal_window,n=n||r.tools.remove_modal_window;var s=t(document.createElement("div"));s.attr("id","gmailJsModalBackground"),s.attr("class","Kj-JD-Jh"),s.attr("aria-hidden","true"),s.attr("style","opacity:0.75;width:100%;height:100%;");var l=t(document.createElement("div"));l.attr("id","gmailJsModalWindow"),l.attr("class","Kj-JD"),l.attr("tabindex","0"),l.attr("role","alertdialog"),l.attr("aria-labelledby","gmailJsModalWindowTitle"),l.attr("style","left:50%;top:50%;opacity:1;");var c=t(document.createElement("div"));c.attr("class","Kj-JD-K7 Kj-JD-K7-GIHV4");var d=t(document.createElement("span"));d.attr("id","gmailJsModalWindowTitle"),d.attr("class","Kj-JD-K7-K0"),d.attr("role","heading"),d.html(e);var u=t(document.createElement("span"));u.attr("id","gmailJsModalWindowClose"),u.attr("class","Kj-JD-K7-Jq"),u.attr("role","button"),u.attr("tabindex","0"),u.attr("aria-label","Close"),u.click(i),c.append(d),c.append(u);var m=t(document.createElement("div"));m.attr("id","gmailJsModalWindowContent"),m.attr("class","Kj-JD-Jz"),m.html(a);var h=t(document.createElement("div"));h.attr("class","Kj-JD-Jl");var f=t(document.createElement("button"));f.attr("id","gmailJsModalWindowOk"),f.attr("class","J-at1-auR J-at1-atl"),f.attr("name","ok"),f.text("OK"),f.click(o);var _=t(document.createElement("button"));_.attr("id","gmailJsModalWindowCancel"),_.attr("name","cancel"),_.text("Cancel"),_.click(n),h.append(f),h.append(_),l.append(c),l.append(m),l.append(h),t(document.body).append(s),t(document.body).append(l);var p=function(){l.css({top:(t(window).height()-l.outerHeight())/2,left:(t(window).width()-l.outerWidth())/2})};p(),l.bind("DOMSubtreeModified",p),t(window).resize(p)},r.tools.toggle_minimize=function(){var e=t("[alt='Minimize']")[0];return!!e&&(r.helper.trigger_mouse_click(e),!0)},r.chat.is_hangouts=function(){if(void 0!==r.tracker.hangouts)return r.tracker.hangouts;var e=t(".dw");if(e.length>1)throw"Figuring out is hangouts - more than one dw classes found";if(0===e.length)throw"Figuring out is hangouts - no dw classes found";var a=e[0],o=t(".nH.aJl.nn",a);return o.length>0?(r.tracker.hangouts=!0,!0):(o=t(".nH.nn",a)).length>2?(r.tracker.hangouts=!1,!1):void 0},r.dom.composes=function(){var e=[];return t("div.M9").each(function(t,a){e.push(new r.dom.compose(a))}),e},r.dom.compose=function(e){return this.constructor!==r.dom.compose?new r.dom.compose(e):((e=t(e))&&(e.hasClass("M9")||e.hasClass("AD"))||r.tools.error("api.dom.compose called with invalid element"),this.$el=e,this)},a(r.dom.compose.prototype,{id:function(){return this.dom("id").val()},email_id:function(){return this.dom("draft").val()},is_inline:function(){return this.$el.closest("td.Bu").length>0},recipients:function(e){"object"!=typeof e&&(e={});var t=e.type?"[name="+e.type+"]":"",r=e.flat?[]:{};return this.$el.find(".GS input[type=hidden]"+t).each(function(t,a){e.flat?r.push(a.value):(r[a.name]||(r[a.name]=[]),r[a.name].push(a.value))}),r},to:function(e){return this.dom("to").val(e)},cc:function(e){return this.dom("cc").val(e)},bcc:function(e){return this.dom("bcc").val(e)},subject:function(e){return e&&this.dom("all_subjects").val(e),(e=this.dom("subjectbox").val())||this.dom("subject").val()},from:function(){var e=this.dom("from");if(e.length){var t=e.val();if(t)return r.tools.extract_email_address(t)}return r.get.user_email()},body:function(e){var t=this.dom("body");return e&&t.html(e),t.html()},send:function(){return this.dom("send_button").click()},find:function(e){return this.$el.find(e)},dom:function(e){if(!e)return this.$el;var t={to:"textarea[name=to]",cc:"textarea[name=cc]",bcc:"textarea[name=bcc]",id:"input[name=composeid]",draft:"input[name=draft]",subject:"input[name=subject]",subjectbox:"input[name=subjectbox]",all_subjects:"input[name=subjectbox], input[name=subject]",body:"div[contenteditable=true]",reply:"M9",forward:"M9",from:"input[name=from]",send_button:"div.T-I.T-I-atl"};return t[e]||r.tools.error('Dom lookup failed. Unable to find config for "'+e+'"',t,e,t[e]),this.$el.find(t[e])}}),r.dom.email=function(e){return this.constructor!==r.dom.email?new r.dom.email(e):("string"==typeof e?(this.id=e,e=t("div.adn[data-legacy-message-id='"+this.id+"']")):e=t(e),e&&e.hasClass("adn")||r.tools.error("api.dom.email called with invalid element/id"),this.$el=e,this.id||(this.id=this.$el.data("legacyMessageId")),this)},a(r.dom.email.prototype,{body:function(e){var t=this.dom("body");return e&&t.html(e),t.html()},from:function(e,t){var r=this.dom("from");return e&&r.attr("email",e),t&&(r.attr("name",t),r.html(t)),{email:r.attr("email"),name:r.attr("name"),el:r}},to:function(e){if(e){t.isArray(e)||(e=[e]);var r=[];t.each(e,function(e,a){r.push(t("<span />").attr({dir:"ltr",email:a.email,name:a.name}).addClass("g2").html(a.name).wrap("<p/>").parent().html())}),this.dom("to_wrapper").html("to "+r.join(", "))}var a=[];return this.dom("to").each(function(){var e=t(this);a.push({email:e.attr("email"),name:e.attr("name"),el:e})}),a},attachments:function(){var e=[];return this.dom("attachments").each(function(){var a=t(this),o={};o.$el=a,o.name=a.find(".aV3").html(),o.size=a.find(".SaH2Ve").html();var n=a.attr("download_url");if(n){var i=r.tools.parse_attachment_url(n);o.url=i.url,o.type=i.type}e.push(o)}),e},data:function(){if("object"!=typeof r.dom.email_cache&&(r.dom.email_cache={}),!r.dom.email_cache[this.id]){var e=r.get.email_data(this.id);t.each(e.threads,function(e,t){r.dom.email_cache[e]=t})}return r.dom.email_cache[this.id]},source:function(){return r.get.email_source(this.id)},dom:function(e){if(!e)return this.$el;var t={body:"div.a3s",from:"span[email].gD",to:"span[email].g2",to_wrapper:"span.hb",timestamp:"span.g3",star:"div.zd",attachments:"div.hq.gt div.aQH span.aZo",reply_button:"div[role=button].aaq",menu_button:"div[role=button].aap",details_button:"div[role=button].ajz"};return t[e]||r.tools.error('Dom lookup failed. Unable to find config for "'+e+'"'),this.$el.find(t[e])}}),r.dom.thread=function(e){return this.constructor!==r.dom.thread?new r.dom.thread(e):(e&&e.hasClass("if")||r.tools.error("api.dom.thread called with invalid element/id"),this.$el=e,this)},a(r.dom.thread.prototype,{dom:function(e){if(!e)return this.$el;var t={opened_email:"div.adn",subject:"h2.hP",labels:"div.hN"};return t[e]||r.tools.error('Dom lookup failed. Unable to find config for "'+e+'"'),this.$el.find(t[e])}}),r.compose.start_compose=function(){var e=t(".T-I.J-J5-Ji.T-I-KE.L3")[0];return!!e&&(r.helper.trigger_mouse_click(e),!0)},r};"undefined"!=typeof exports&&(exports.Gmail=Gmail);