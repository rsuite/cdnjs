/*! OOUI v0.26.5 | http://oojs.mit-license.org */
!function(p){"use strict";p.ui.mixin.DraggableElement=function(t){t=t||{},this.index=null,this.$handle=t.$handle||this.$element,this.wasHandleUsed=null,this.$element.addClass("oo-ui-draggableElement").on({mousedown:this.onDragMouseDown.bind(this),dragstart:this.onDragStart.bind(this),dragover:this.onDragOver.bind(this),dragend:this.onDragEnd.bind(this),drop:this.onDrop.bind(this)}),this.$handle.addClass("oo-ui-draggableElement-handle"),this.toggleDraggable(void 0===t.draggable||!!t.draggable)},p.initClass(p.ui.mixin.DraggableElement),p.ui.mixin.DraggableElement.static.cancelButtonMouseDownEvents=!1,p.ui.mixin.DraggableElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.$handle.toggleClass("oo-ui-draggableElement-undraggable",!this.draggable),this.$element.prop("draggable",this.draggable))},p.ui.mixin.DraggableElement.prototype.isDraggable=function(){return this.draggable},p.ui.mixin.DraggableElement.prototype.onDragMouseDown=function(t){this.isDraggable()&&(this.wasHandleUsed=this.$handle[0]===this.$element[0]||p.ui.contains(this.$handle[0],t.target,!0))},p.ui.mixin.DraggableElement.prototype.onDragStart=function(t){var e=this,i=t.originalEvent.dataTransfer;if(!this.wasHandleUsed||!this.isDraggable())return!1;i.dropEffect="none",i.effectAllowed="move";try{i.setData("application-x/OOUI-draggable",this.getIndex())}catch(t){}return this.$element.addClass("oo-ui-draggableElement-clone"),setTimeout(function(){e.$element.removeClass("oo-ui-draggableElement-clone").addClass("oo-ui-draggableElement-placeholder")}),this.emit("dragstart",this),!0},p.ui.mixin.DraggableElement.prototype.onDragEnd=function(){this.$element.removeClass("oo-ui-draggableElement-placeholder"),this.emit("dragend")},p.ui.mixin.DraggableElement.prototype.onDrop=function(t){t.preventDefault(),this.emit("drop",t)},p.ui.mixin.DraggableElement.prototype.onDragOver=function(t){t.preventDefault()},p.ui.mixin.DraggableElement.prototype.setIndex=function(t){this.index!==t&&(this.index=t,this.$element.data("index",t))},p.ui.mixin.DraggableElement.prototype.getIndex=function(){return this.index},p.ui.mixin.DraggableGroupElement=function(t){t=t||{},p.ui.mixin.GroupElement.call(this,t),this.orientation=t.orientation||"vertical",this.dragItem=null,this.itemKeys={},this.dir=null,this.itemsOrder=null,this.draggable=void 0===t.draggable||!!t.draggable,this.aggregate({dragstart:"itemDragStart",dragend:"itemDragEnd",drop:"itemDrop"}),this.connect(this,{itemDragStart:"onItemDragStart",itemDrop:"onItemDropOrDragEnd",itemDragEnd:"onItemDropOrDragEnd"}),Array.isArray(t.items)&&this.addItems(t.items),this.$element.addClass("oo-ui-draggableGroupElement").toggleClass("oo-ui-draggableGroupElement-horizontal","horizontal"===this.orientation)},p.mixinClass(p.ui.mixin.DraggableGroupElement,p.ui.mixin.GroupElement),p.ui.mixin.DraggableGroupElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.getItems().forEach(function(t){t.toggleDraggable(this.draggable)}.bind(this)),this.emit("draggable",this.draggable))},p.ui.mixin.DraggableGroupElement.prototype.isDraggable=function(){return this.draggable},p.ui.mixin.DraggableGroupElement.prototype.onItemDragStart=function(t){this.isDraggable()&&(this.itemsOrder=this.items.slice(),this.updateIndexes(),"horizontal"===this.orientation&&(this.dir=this.$element.css("direction")),this.setDragItem(t))},p.ui.mixin.DraggableGroupElement.prototype.updateIndexes=function(){var t,e;for(t=0,e=this.itemsOrder.length;t<e;t++)this.itemsOrder[t].setIndex(t)},p.ui.mixin.DraggableGroupElement.prototype.onItemDropOrDragEnd=function(){var t,e,i=this.getDragItem();return i&&(e=this.items.indexOf(i),(t=i.getIndex()+(i.getIndex()>e?1:0))!==e&&(this.reorder(this.getDragItem(),t),this.emit("reorder",this.getDragItem(),t)),this.updateIndexes()),this.unsetDragItem(),!1},p.ui.mixin.DraggableGroupElement.prototype.onDragOver=function(t){var e,i,n=this.getDragItem(),s=n.getIndex();void 0!==(e=$(t.target).closest(".oo-ui-draggableElement").data("index"))&&e!==s&&(0<(i=e+(s<e?1:0))?this.$group.children().eq(i-1).after(n.$element):this.$group.prepend(n.$element),this.itemsOrder.splice(e,0,this.itemsOrder.splice(s,1)[0]),this.updateIndexes(),this.emit("drag",n,i)),t.preventDefault()},p.ui.mixin.DraggableGroupElement.prototype.reorder=function(t,e){this.addItems([t],e)},p.ui.mixin.DraggableGroupElement.prototype.setDragItem=function(t){this.dragItem!==t&&(this.dragItem=t,this.$element.on("dragover",this.onDragOver.bind(this)),this.$element.addClass("oo-ui-draggableGroupElement-dragging"))},p.ui.mixin.DraggableGroupElement.prototype.unsetDragItem=function(){this.dragItem&&(this.dragItem=null,this.$element.off("dragover"),this.$element.removeClass("oo-ui-draggableGroupElement-dragging"))},p.ui.mixin.DraggableGroupElement.prototype.getDragItem=function(){return this.dragItem},p.ui.mixin.RequestManager=function(){this.requestCache={},this.requestQuery=null,this.requestRequest=null},p.initClass(p.ui.mixin.RequestManager),p.ui.mixin.RequestManager.prototype.getRequestData=function(){var e,i=this,n=this.getRequestQuery(),s=$.Deferred();return this.abortRequest(),Object.prototype.hasOwnProperty.call(this.requestCache,n)?s.resolve(this.requestCache[n]):(this.pushPending&&this.pushPending(),this.requestQuery=n,(e=this.requestRequest=this.getRequest()).always(function(){i.popPending&&i.popPending()}).done(function(t){e===i.requestRequest&&(i.requestQuery=null,i.requestRequest=null,i.requestCache[n]=i.getRequestCacheDataFromResponse(t),s.resolve(i.requestCache[n]))}).fail(function(){e===i.requestRequest&&(i.requestQuery=null,i.requestRequest=null,s.reject())})),s.promise()},p.ui.mixin.RequestManager.prototype.abortRequest=function(){var t=this.requestRequest;t&&(this.requestRequest=null,this.requestQuery=null,t.abort())},p.ui.mixin.RequestManager.prototype.getRequestQuery=null,p.ui.mixin.RequestManager.prototype.getRequest=null,p.ui.mixin.RequestManager.prototype.getRequestCacheDataFromResponse=null,p.ui.mixin.LookupElement=function(t){t=$.extend({highlightFirst:!0},t),p.ui.mixin.RequestManager.call(this,t),this.$overlay=(!0===t.$overlay?p.ui.getDefaultOverlay():t.$overlay)||this.$element,this.lookupMenu=new p.ui.MenuSelectWidget({widget:this,input:this,$floatableContainer:t.$container||this.$element}),this.allowSuggestionsWhenEmpty=t.allowSuggestionsWhenEmpty||!1,this.lookupsDisabled=!1,this.lookupInputFocused=!1,this.lookupHighlightFirstItem=t.highlightFirst,this.$input.on({focus:this.onLookupInputFocus.bind(this),blur:this.onLookupInputBlur.bind(this),mousedown:this.onLookupInputMouseDown.bind(this)}),this.connect(this,{change:"onLookupInputChange"}),this.lookupMenu.connect(this,{toggle:"onLookupMenuToggle",choose:"onLookupMenuItemChoose"}),this.$input.attr({role:"combobox","aria-owns":this.lookupMenu.getElementId(),"aria-autocomplete":"list"}),this.$element.addClass("oo-ui-lookupElement"),this.lookupMenu.$element.addClass("oo-ui-lookupElement-menu"),this.$overlay.append(this.lookupMenu.$element)},p.mixinClass(p.ui.mixin.LookupElement,p.ui.mixin.RequestManager),p.ui.mixin.LookupElement.prototype.onLookupInputFocus=function(){this.lookupInputFocused=!0,this.populateLookupMenu()},p.ui.mixin.LookupElement.prototype.onLookupInputBlur=function(){this.closeLookupMenu(),this.lookupInputFocused=!1},p.ui.mixin.LookupElement.prototype.onLookupInputMouseDown=function(){this.lookupInputFocused&&!this.lookupMenu.isVisible()&&this.populateLookupMenu()},p.ui.mixin.LookupElement.prototype.onLookupInputChange=function(){this.lookupInputFocused&&this.populateLookupMenu()},p.ui.mixin.LookupElement.prototype.onLookupMenuToggle=function(t){t||(this.abortLookupRequest(),this.lookupMenu.clearItems())},p.ui.mixin.LookupElement.prototype.onLookupMenuItemChoose=function(t){this.setValue(t.getData())},p.ui.mixin.LookupElement.prototype.getLookupMenu=function(){return this.lookupMenu},p.ui.mixin.LookupElement.prototype.setLookupsDisabled=function(t){this.lookupsDisabled=!!t},p.ui.mixin.LookupElement.prototype.openLookupMenu=function(){return this.lookupMenu.isEmpty()||this.lookupMenu.toggle(!0),this},p.ui.mixin.LookupElement.prototype.closeLookupMenu=function(){return this.lookupMenu.toggle(!1),this.abortLookupRequest(),this.lookupMenu.clearItems(),this},p.ui.mixin.LookupElement.prototype.populateLookupMenu=function(){var e=this,t=this.getValue();if(!this.lookupsDisabled&&!this.isReadOnly())return this.allowSuggestionsWhenEmpty||""!==t?t!==this.lookupQuery&&this.getLookupMenuItems().done(function(t){e.lookupMenu.clearItems(),t.length?(e.lookupMenu.addItems(t).toggle(!0),e.initializeLookupMenuSelection()):e.lookupMenu.toggle(!1)}).fail(function(){e.lookupMenu.clearItems()}):this.closeLookupMenu(),this},p.ui.mixin.LookupElement.prototype.initializeLookupMenuSelection=function(){this.lookupHighlightFirstItem&&!this.lookupMenu.findSelectedItem()&&this.lookupMenu.highlightItem(this.lookupMenu.findFirstSelectableItem())},p.ui.mixin.LookupElement.prototype.getLookupMenuItems=function(){return this.getRequestData().then(function(t){return this.getLookupMenuOptionsFromData(t)}.bind(this))},p.ui.mixin.LookupElement.prototype.abortLookupRequest=function(){this.abortRequest()},p.ui.mixin.LookupElement.prototype.getLookupRequest=null,p.ui.mixin.LookupElement.prototype.getLookupCacheDataFromResponse=null,p.ui.mixin.LookupElement.prototype.getLookupMenuOptionsFromData=null,p.ui.mixin.LookupElement.prototype.setReadOnly=function(t){return p.ui.TextInputWidget.prototype.setReadOnly.call(this,t),this.isReadOnly()&&this.lookupMenu&&this.closeLookupMenu(),this},p.ui.mixin.LookupElement.prototype.getRequestQuery=function(){return this.getValue()},p.ui.mixin.LookupElement.prototype.getRequest=function(){return this.getLookupRequest()},p.ui.mixin.LookupElement.prototype.getRequestCacheDataFromResponse=function(t){return this.getLookupCacheDataFromResponse(t)},p.ui.TabPanelLayout=function(t,e){p.isPlainObject(t)&&void 0===e&&(t=(e=t).name),e=$.extend({scrollable:!0},e),p.ui.TabPanelLayout.parent.call(this,e),this.name=t,this.label=e.label,this.tabItem=null,this.active=!1,this.$element.addClass("oo-ui-tabPanelLayout")},p.inheritClass(p.ui.TabPanelLayout,p.ui.PanelLayout),p.ui.TabPanelLayout.prototype.getName=function(){return this.name},p.ui.TabPanelLayout.prototype.isActive=function(){return this.active},p.ui.TabPanelLayout.prototype.getTabItem=function(){return this.tabItem},p.ui.TabPanelLayout.prototype.setTabItem=function(t){return this.tabItem=t||null,t&&this.setupTabItem(),this},p.ui.TabPanelLayout.prototype.setupTabItem=function(){return this.label&&this.tabItem.setLabel(this.label),this},p.ui.TabPanelLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-tabPanelLayout-active",this.active),this.emit("active",this.active))},p.ui.PageLayout=function(t,e){p.isPlainObject(t)&&void 0===e&&(t=(e=t).name),e=$.extend({scrollable:!0},e),p.ui.PageLayout.parent.call(this,e),this.name=t,this.outlineItem=null,this.active=!1,this.$element.addClass("oo-ui-pageLayout")},p.inheritClass(p.ui.PageLayout,p.ui.PanelLayout),p.ui.PageLayout.prototype.getName=function(){return this.name},p.ui.PageLayout.prototype.isActive=function(){return this.active},p.ui.PageLayout.prototype.getOutlineItem=function(){return this.outlineItem},p.ui.PageLayout.prototype.setOutlineItem=function(t){return this.outlineItem=t||null,t&&this.setupOutlineItem(),this},p.ui.PageLayout.prototype.setupOutlineItem=function(){return this},p.ui.PageLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-pageLayout-active",t),this.emit("active",this.active))},p.ui.StackLayout=function(t){t=$.extend({scrollable:!0},t),p.ui.StackLayout.parent.call(this,t),p.ui.mixin.GroupElement.call(this,$.extend({},t,{$group:this.$element})),this.currentItem=null,this.continuous=!!t.continuous,this.$element.addClass("oo-ui-stackLayout"),this.continuous&&(this.$element.addClass("oo-ui-stackLayout-continuous"),this.$element.on("scroll",p.ui.debounce(this.onScroll.bind(this),250))),Array.isArray(t.items)&&this.addItems(t.items)},p.inheritClass(p.ui.StackLayout,p.ui.PanelLayout),p.mixinClass(p.ui.StackLayout,p.ui.mixin.GroupElement),p.ui.StackLayout.prototype.onScroll=function(){var t,e=this.items.length,i=this.items.indexOf(this.currentItem),n=i,s=this.$element[0].getBoundingClientRect();if(s&&(s.top||s.bottom)){if((t=o(this.currentItem)).bottom<s.top)for(;++n<e&&!u(this.items[n]););else if(t.top>s.bottom)for(;0<=--n&&!u(this.items[n]););n!==i&&this.emit("visibleItemChange",this.items[n])}function o(t){return t.$element[0].getBoundingClientRect()}function u(t){var e=o(t);return e.bottom>s.top&&e.top<s.bottom}},p.ui.StackLayout.prototype.getCurrentItem=function(){return this.currentItem},p.ui.StackLayout.prototype.unsetCurrentItem=function(){null!==this.currentItem&&(this.currentItem=null,this.emit("set",null))},p.ui.StackLayout.prototype.addItems=function(t,e){return this.updateHiddenState(t,this.currentItem),p.ui.mixin.GroupElement.prototype.addItems.call(this,t,e),!this.currentItem&&t.length&&this.setItem(t[0]),this},p.ui.StackLayout.prototype.removeItems=function(t){return p.ui.mixin.GroupElement.prototype.removeItems.call(this,t),-1!==t.indexOf(this.currentItem)&&(this.items.length?this.setItem(this.items[0]):this.unsetCurrentItem()),this},p.ui.StackLayout.prototype.clearItems=function(){return this.unsetCurrentItem(),p.ui.mixin.GroupElement.prototype.clearItems.call(this),this},p.ui.StackLayout.prototype.setItem=function(t){return t!==this.currentItem&&(this.updateHiddenState(this.items,t),-1!==this.items.indexOf(t)?(this.currentItem=t,this.emit("set",t)):this.unsetCurrentItem()),this},p.ui.StackLayout.prototype.updateHiddenState=function(t,e){var i,n;if(!this.continuous){for(i=0,n=t.length;i<n;i++)e&&e===t[i]||(t[i].$element.addClass("oo-ui-element-hidden"),t[i].$element.attr("aria-hidden","true"));e&&(e.$element.removeClass("oo-ui-element-hidden"),e.$element.removeAttr("aria-hidden"))}},p.ui.MenuLayout=function(t){t=$.extend({expanded:!0,showMenu:!0,menuPosition:"before"},t),p.ui.MenuLayout.parent.call(this,t),this.expanded=!!t.expanded,this.$menu=$("<div>"),this.$content=$("<div>"),this.$menu.addClass("oo-ui-menuLayout-menu"),this.$content.addClass("oo-ui-menuLayout-content"),this.$element.addClass("oo-ui-menuLayout"),t.expanded?this.$element.addClass("oo-ui-menuLayout-expanded"):this.$element.addClass("oo-ui-menuLayout-static"),this.setMenuPosition(t.menuPosition),this.toggleMenu(t.showMenu)},p.inheritClass(p.ui.MenuLayout,p.ui.Layout),p.ui.MenuLayout.prototype.toggleMenu=function(t){return t=void 0===t?!this.showMenu:!!t,this.showMenu!==t&&(this.showMenu=t,this.$element.toggleClass("oo-ui-menuLayout-showMenu",this.showMenu).toggleClass("oo-ui-menuLayout-hideMenu",!this.showMenu),this.$menu.attr("aria-hidden",this.showMenu?"false":"true")),this},p.ui.MenuLayout.prototype.isMenuVisible=function(){return this.showMenu},p.ui.MenuLayout.prototype.setMenuPosition=function(t){return this.$element.removeClass("oo-ui-menuLayout-"+this.menuPosition),this.menuPosition=t,"top"===this.menuPosition||"before"===this.menuPosition?this.$element.append(this.$menu,this.$content):this.$element.append(this.$content,this.$menu),this.$element.addClass("oo-ui-menuLayout-"+t),this},p.ui.MenuLayout.prototype.getMenuPosition=function(){return this.menuPosition},p.ui.BookletLayout=function(t){t=t||{},p.ui.BookletLayout.parent.call(this,t),this.currentPageName=null,this.pages={},this.ignoreFocus=!1,this.stackLayout=new p.ui.StackLayout({continuous:!!t.continuous,expanded:this.expanded}),this.$content.append(this.stackLayout.$element),this.autoFocus=void 0===t.autoFocus||!!t.autoFocus,this.outlineVisible=!1,this.outlined=!!t.outlined,this.outlined&&(this.editable=!!t.editable,this.outlineControlsWidget=null,this.outlineSelectWidget=new p.ui.OutlineSelectWidget,this.outlinePanel=new p.ui.PanelLayout({expanded:this.expanded,scrollable:!0}),this.$menu.append(this.outlinePanel.$element),this.outlineVisible=!0,this.editable&&(this.outlineControlsWidget=new p.ui.OutlineControlsWidget(this.outlineSelectWidget))),this.toggleMenu(this.outlined),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.outlined&&(this.outlineSelectWidget.connect(this,{select:"onOutlineSelectWidgetSelect"}),this.scrolling=!1,this.stackLayout.connect(this,{visibleItemChange:"onStackLayoutVisibleItemChange"})),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-bookletLayout"),this.stackLayout.$element.addClass("oo-ui-bookletLayout-stackLayout"),this.outlined&&(this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel").append(this.outlineSelectWidget.$element),this.editable&&this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel-editable").append(this.outlineControlsWidget.$element))},p.inheritClass(p.ui.BookletLayout,p.ui.MenuLayout),p.ui.BookletLayout.prototype.onStackLayoutFocus=function(t){var e,i;for(e in i=$(t.target).closest(".oo-ui-pageLayout"),this.pages)if(this.pages[e].$element[0]===i[0]&&e!==this.currentPageName){this.setPage(e);break}},p.ui.BookletLayout.prototype.onStackLayoutVisibleItemChange=function(t){this.scrolling=!0,this.outlineSelectWidget.selectItemByData(t.getName()),this.scrolling=!1},p.ui.BookletLayout.prototype.onStackLayoutSet=function(t){var e,i=this;t&&(e=this.stackLayout.continuous&&!this.scrolling?t.scrollElementIntoView():$.Deferred().resolve(),this.autoFocus&&!p.ui.isMobile()&&e.done(function(){i.focus()}))},p.ui.BookletLayout.prototype.focus=function(t){var e,i=this.stackLayout.getItems();!(e=void 0!==t&&i[t]?i[t]:this.stackLayout.getCurrentItem())&&this.outlined&&(this.selectFirstSelectablePage(),e=this.stackLayout.getCurrentItem()),e&&(p.ui.contains(e.$element[0],this.getElementDocument().activeElement,!0)||e.focus())},p.ui.BookletLayout.prototype.focusFirstFocusable=function(){p.ui.findFocusable(this.stackLayout.$element).focus()},p.ui.BookletLayout.prototype.onOutlineSelectWidgetSelect=function(t){t&&this.setPage(t.getData())},p.ui.BookletLayout.prototype.isOutlined=function(){return this.outlined},p.ui.BookletLayout.prototype.isEditable=function(){return this.editable},p.ui.BookletLayout.prototype.isOutlineVisible=function(){return this.outlined&&this.outlineVisible},p.ui.BookletLayout.prototype.toggleOutline=function(t){var e=this;return this.outlined&&(t=void 0===t?!this.outlineVisible:!!t,this.outlineVisible=t,this.toggleMenu(t),t&&this.editable&&setTimeout(function(){p.ui.Element.static.reconsiderScrollbars(e.outlinePanel.$element[0])},200)),this},p.ui.BookletLayout.prototype.findClosestPage=function(t){var e,i,n,s=this.stackLayout.getItems(),o=s.indexOf(t);if(-1!==o&&(e=s[o+1],i=s[o-1],this.outlined)){if(n=this.outlineSelectWidget.findItemFromData(t.getName()).getLevel(),i&&n===this.outlineSelectWidget.findItemFromData(i.getName()).getLevel())return i;if(e&&n===this.outlineSelectWidget.findItemFromData(e.getName()).getLevel())return e}return i||e||null},p.ui.BookletLayout.prototype.getOutline=function(){return this.outlineSelectWidget},p.ui.BookletLayout.prototype.getOutlineControls=function(){return this.outlineControlsWidget},p.ui.BookletLayout.prototype.getPage=function(t){return this.pages[t]},p.ui.BookletLayout.prototype.getCurrentPage=function(){var t=this.getCurrentPageName();return t?this.getPage(t):void 0},p.ui.BookletLayout.prototype.getCurrentPageName=function(){return this.currentPageName},p.ui.BookletLayout.prototype.addPages=function(t,e){var i,n,s,o,u,l,a=this.stackLayout.getItems(),h=[],r=[];for(i=0,n=t.length;i<n;i++)s=(o=t[i]).getName(),Object.prototype.hasOwnProperty.call(this.pages,s)&&(-1!==(l=a.indexOf(this.pages[s]))&&l+1<e&&e--,h.push(this.pages[s]));for(h.length&&this.removePages(h),i=0,n=t.length;i<n;i++)s=(o=t[i]).getName(),this.pages[o.getName()]=o,this.outlined&&(u=new p.ui.OutlineOptionWidget({data:s}),o.setOutlineItem(u),r.push(u));return this.outlined&&r.length&&(this.outlineSelectWidget.addItems(r,e),this.selectFirstSelectablePage()),this.stackLayout.addItems(t,e),this.emit("add",t,e),this},p.ui.BookletLayout.prototype.removePages=function(t){var e,i,n,s,o=[];for(e=0,i=t.length;e<i;e++)n=(s=t[e]).getName(),delete this.pages[n],this.outlined&&(o.push(this.outlineSelectWidget.findItemFromData(n)),s.setOutlineItem(null));return this.outlined&&o.length&&(this.outlineSelectWidget.removeItems(o),this.selectFirstSelectablePage()),this.stackLayout.removeItems(t),this.emit("remove",t),this},p.ui.BookletLayout.prototype.clearPages=function(){var t,e,i=this.stackLayout.getItems();if(this.pages={},this.currentPageName=null,this.outlined)for(this.outlineSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setOutlineItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},p.ui.BookletLayout.prototype.setPage=function(t){var e,i,n=this.pages[t],s=this.currentPageName&&this.pages[this.currentPageName];t!==this.currentPageName&&(this.outlined&&(e=this.outlineSelectWidget.findSelectedItem())&&e.getData()!==t&&this.outlineSelectWidget.selectItemByData(t),n&&(s&&(s.setActive(!1),this.autoFocus&&!p.ui.isMobile()&&this.stackLayout.continuous&&0!==p.ui.findFocusable(n.$element).length&&(i=s.$element.find(":focus")).length&&i[0].blur()),this.currentPageName=t,n.setActive(!0),this.stackLayout.setItem(n),!this.stackLayout.continuous&&s&&(i=s.$element.find(":focus")).length&&i[0].blur(),this.emit("set",n)))},p.ui.BookletLayout.prototype.selectFirstSelectablePage=function(){return this.outlineSelectWidget.findSelectedItem()||this.outlineSelectWidget.selectItem(this.outlineSelectWidget.findFirstSelectableItem()),this},p.ui.IndexLayout=function(t){t=$.extend({},t,{menuPosition:"top"}),p.ui.IndexLayout.parent.call(this,t),this.currentTabPanelName=null,this.tabPanels={},this.ignoreFocus=!1,this.stackLayout=new p.ui.StackLayout({continuous:!!t.continuous,expanded:this.expanded}),this.$content.append(this.stackLayout.$element),this.autoFocus=void 0===t.autoFocus||!!t.autoFocus,this.tabSelectWidget=new p.ui.TabSelectWidget,this.tabPanel=new p.ui.PanelLayout({expanded:this.expanded}),this.$menu.append(this.tabPanel.$element),this.toggleMenu(!0),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.tabSelectWidget.connect(this,{select:"onTabSelectWidgetSelect"}),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-indexLayout"),this.stackLayout.$element.addClass("oo-ui-indexLayout-stackLayout"),this.tabPanel.$element.addClass("oo-ui-indexLayout-tabPanel").append(this.tabSelectWidget.$element)},p.inheritClass(p.ui.IndexLayout,p.ui.MenuLayout),p.ui.IndexLayout.prototype.onStackLayoutFocus=function(t){var e,i;for(e in i=$(t.target).closest(".oo-ui-tabPanelLayout"),this.tabPanels)if(this.tabPanels[e].$element[0]===i[0]&&e!==this.currentTabPanelName){this.setTabPanel(e);break}},p.ui.IndexLayout.prototype.onStackLayoutSet=function(t){t&&this.autoFocus&&!p.ui.isMobile()&&this.focus()},p.ui.IndexLayout.prototype.focus=function(t){var e,i=this.stackLayout.getItems();(e=void 0!==t&&i[t]?i[t]:this.stackLayout.getCurrentItem())||(this.selectFirstSelectableTabPanel(),e=this.stackLayout.getCurrentItem()),e&&(p.ui.contains(e.$element[0],this.getElementDocument().activeElement,!0)||e.focus())},p.ui.IndexLayout.prototype.focusFirstFocusable=function(){p.ui.findFocusable(this.stackLayout.$element).focus()},p.ui.IndexLayout.prototype.onTabSelectWidgetSelect=function(t){t&&this.setTabPanel(t.getData())},p.ui.IndexLayout.prototype.getClosestTabPanel=function(t){var e,i,n,s=this.stackLayout.getItems(),o=s.indexOf(t);if(-1!==o){if(e=s[o+1],i=s[o-1],n=this.tabSelectWidget.findItemFromData(t.getName()).getLevel(),i&&n===this.tabSelectWidget.findItemFromData(i.getName()).getLevel())return i;if(e&&n===this.tabSelectWidget.findItemFromData(e.getName()).getLevel())return e}return i||e||null},p.ui.IndexLayout.prototype.getTabs=function(){return this.tabSelectWidget},p.ui.IndexLayout.prototype.getTabPanel=function(t){return this.tabPanels[t]},p.ui.IndexLayout.prototype.getCurrentTabPanel=function(){var t=this.getCurrentTabPanelName();return t?this.getTabPanel(t):void 0},p.ui.IndexLayout.prototype.getCurrentTabPanelName=function(){return this.currentTabPanelName},p.ui.IndexLayout.prototype.addTabPanels=function(t,e){var i,n,s,o,u,l,a=this.stackLayout.getItems(),h=[],r=[];for(i=0,n=t.length;i<n;i++)s=(o=t[i]).getName(),Object.prototype.hasOwnProperty.call(this.tabPanels,s)&&(-1!==(l=a.indexOf(this.tabPanels[s]))&&l+1<e&&e--,h.push(this.tabPanels[s]));for(h.length&&this.removeTabPanels(h),i=0,n=t.length;i<n;i++)s=(o=t[i]).getName(),this.tabPanels[o.getName()]=o,u=new p.ui.TabOptionWidget({data:s}),o.setTabItem(u),r.push(u);return r.length&&(this.tabSelectWidget.addItems(r,e),this.selectFirstSelectableTabPanel()),this.stackLayout.addItems(t,e),this.emit("add",t,e),this},p.ui.IndexLayout.prototype.removeTabPanels=function(t){var e,i,n,s,o=[];for(e=0,i=t.length;e<i;e++)n=(s=t[e]).getName(),delete this.tabPanels[n],o.push(this.tabSelectWidget.findItemFromData(n)),s.setTabItem(null);return o.length&&(this.tabSelectWidget.removeItems(o),this.selectFirstSelectableTabPanel()),this.stackLayout.removeItems(t),this.emit("remove",t),this},p.ui.IndexLayout.prototype.clearTabPanels=function(){var t,e,i=this.stackLayout.getItems();for(this.tabPanels={},this.currentTabPanelName=null,this.tabSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setTabItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},p.ui.IndexLayout.prototype.setTabPanel=function(t){var e,i,n=this.tabPanels[t],s=this.currentTabPanelName&&this.tabPanels[this.currentTabPanelName];t!==this.currentTabPanelName&&((e=this.tabSelectWidget.findSelectedItem())&&e.getData()!==t&&this.tabSelectWidget.selectItemByData(t),n&&(s&&(s.setActive(!1),this.autoFocus&&!p.ui.isMobile()&&this.stackLayout.continuous&&0!==p.ui.findFocusable(n.$element).length&&(i=s.$element.find(":focus")).length&&i[0].blur()),this.currentTabPanelName=t,n.setActive(!0),this.stackLayout.setItem(n),!this.stackLayout.continuous&&s&&(i=s.$element.find(":focus")).length&&i[0].blur(),this.emit("set",n)))},p.ui.IndexLayout.prototype.selectFirstSelectableTabPanel=function(){return this.tabSelectWidget.findSelectedItem()||this.tabSelectWidget.selectItem(this.tabSelectWidget.findFirstSelectableItem()),this},p.ui.ToggleWidget=function(t){t=t||{},p.ui.ToggleWidget.parent.call(this,t),this.value=null,this.$element.addClass("oo-ui-toggleWidget"),this.setValue(!!t.value)},p.inheritClass(p.ui.ToggleWidget,p.ui.Widget),p.ui.ToggleWidget.prototype.getValue=function(){return this.value},p.ui.ToggleWidget.prototype.setValue=function(t){return t=!!t,this.value!==t&&(this.value=t,this.emit("change",t),this.$element.toggleClass("oo-ui-toggleWidget-on",t),this.$element.toggleClass("oo-ui-toggleWidget-off",!t)),this},p.ui.ToggleButtonWidget=function(t){t=t||{},p.ui.ToggleButtonWidget.parent.call(this,t),p.ui.mixin.ButtonElement.call(this,$.extend({},t,{active:this.active})),p.ui.mixin.IconElement.call(this,t),p.ui.mixin.IndicatorElement.call(this,t),p.ui.mixin.LabelElement.call(this,t),p.ui.mixin.TitledElement.call(this,$.extend({},t,{$titled:this.$button})),p.ui.mixin.FlaggedElement.call(this,t),p.ui.mixin.TabIndexedElement.call(this,$.extend({},t,{$tabIndexed:this.$button})),this.connect(this,{click:"onAction"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-toggleButtonWidget").append(this.$button)},p.inheritClass(p.ui.ToggleButtonWidget,p.ui.ToggleWidget),p.mixinClass(p.ui.ToggleButtonWidget,p.ui.mixin.ButtonElement),p.mixinClass(p.ui.ToggleButtonWidget,p.ui.mixin.IconElement),p.mixinClass(p.ui.ToggleButtonWidget,p.ui.mixin.IndicatorElement),p.mixinClass(p.ui.ToggleButtonWidget,p.ui.mixin.LabelElement),p.mixinClass(p.ui.ToggleButtonWidget,p.ui.mixin.TitledElement),p.mixinClass(p.ui.ToggleButtonWidget,p.ui.mixin.FlaggedElement),p.mixinClass(p.ui.ToggleButtonWidget,p.ui.mixin.TabIndexedElement),p.ui.ToggleButtonWidget.static.tagName="span",p.ui.ToggleButtonWidget.prototype.onAction=function(){this.setValue(!this.value)},p.ui.ToggleButtonWidget.prototype.setValue=function(t){return(t=!!t)!==this.value&&(this.$button&&this.$button.attr("aria-pressed",t.toString()),this.setActive(t)),p.ui.ToggleButtonWidget.parent.prototype.setValue.call(this,t),this},p.ui.ToggleButtonWidget.prototype.setButtonElement=function(t){this.$button&&this.$button.removeAttr("aria-pressed"),p.ui.mixin.ButtonElement.prototype.setButtonElement.call(this,t),this.$button.attr("aria-pressed",this.value.toString())},p.ui.ToggleSwitchWidget=function(t){p.ui.ToggleSwitchWidget.parent.call(this,t),p.ui.mixin.TabIndexedElement.call(this,t),this.dragging=!1,this.dragStart=null,this.sliding=!1,this.$glow=$("<span>"),this.$grip=$("<span>"),this.$element.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.$glow.addClass("oo-ui-toggleSwitchWidget-glow"),this.$grip.addClass("oo-ui-toggleSwitchWidget-grip"),this.$element.addClass("oo-ui-toggleSwitchWidget").attr("role","checkbox").append(this.$glow,this.$grip)},p.inheritClass(p.ui.ToggleSwitchWidget,p.ui.ToggleWidget),p.mixinClass(p.ui.ToggleSwitchWidget,p.ui.mixin.TabIndexedElement),p.ui.ToggleSwitchWidget.prototype.onClick=function(t){return this.isDisabled()||t.which!==p.ui.MouseButtons.LEFT||this.setValue(!this.value),!1},p.ui.ToggleSwitchWidget.prototype.onKeyPress=function(t){if(!this.isDisabled()&&(t.which===p.ui.Keys.SPACE||t.which===p.ui.Keys.ENTER))return this.setValue(!this.value),!1},p.ui.ToggleSwitchWidget.prototype.setValue=function(t){return p.ui.ToggleSwitchWidget.parent.prototype.setValue.call(this,t),this.$element.attr("aria-checked",this.value.toString()),this},p.ui.ToggleSwitchWidget.prototype.simulateLabelClick=function(){this.isDisabled()||this.setValue(!this.value),this.focus()},p.ui.OutlineControlsWidget=function(t,e){p.isPlainObject(t)&&void 0===e&&(t=(e=t).outline),e=$.extend({icon:"add"},e),p.ui.OutlineControlsWidget.parent.call(this,e),p.ui.mixin.GroupElement.call(this,e),p.ui.mixin.IconElement.call(this,e),this.outline=t,this.$movers=$("<div>"),this.upButton=new p.ui.ButtonWidget({framed:!1,icon:"collapse",title:p.ui.msg("ooui-outline-control-move-up")}),this.downButton=new p.ui.ButtonWidget({framed:!1,icon:"expand",title:p.ui.msg("ooui-outline-control-move-down")}),this.removeButton=new p.ui.ButtonWidget({framed:!1,icon:"trash",title:p.ui.msg("ooui-outline-control-remove")}),this.abilities={move:!0,remove:!0},t.connect(this,{select:"onOutlineChange",add:"onOutlineChange",remove:"onOutlineChange"}),this.upButton.connect(this,{click:["emit","move",-1]}),this.downButton.connect(this,{click:["emit","move",1]}),this.removeButton.connect(this,{click:["emit","remove"]}),this.$element.addClass("oo-ui-outlineControlsWidget"),this.$group.addClass("oo-ui-outlineControlsWidget-items"),this.$movers.addClass("oo-ui-outlineControlsWidget-movers").append(this.removeButton.$element,this.upButton.$element,this.downButton.$element),this.$element.append(this.$icon,this.$group,this.$movers),this.setAbilities(e.abilities||{})},p.inheritClass(p.ui.OutlineControlsWidget,p.ui.Widget),p.mixinClass(p.ui.OutlineControlsWidget,p.ui.mixin.GroupElement),p.mixinClass(p.ui.OutlineControlsWidget,p.ui.mixin.IconElement),p.ui.OutlineControlsWidget.prototype.setAbilities=function(t){var e;for(e in this.abilities)void 0!==t[e]&&(this.abilities[e]=!!t[e]);this.onOutlineChange()},p.ui.OutlineControlsWidget.prototype.onOutlineChange=function(){var t,e,i,n,s=this.outline.getItems(),o=this.outline.findSelectedItem(),u=this.abilities.move&&o&&o.isMovable(),l=this.abilities.remove&&o&&o.isRemovable();if(u){for(t=-1,e=s.length;++t<e;)if(s[t].isMovable()){i=s[t];break}for(t=e;t--;)if(s[t].isMovable()){n=s[t];break}}this.upButton.setDisabled(!u||o===i),this.downButton.setDisabled(!u||o===n),this.removeButton.setDisabled(!l)},p.ui.OutlineOptionWidget=function(t){t=t||{},p.ui.OutlineOptionWidget.parent.call(this,t),this.level=0,this.movable=!!t.movable,this.removable=!!t.removable,this.$element.addClass("oo-ui-outlineOptionWidget"),this.setLevel(t.level)},p.inheritClass(p.ui.OutlineOptionWidget,p.ui.DecoratedOptionWidget),p.ui.OutlineOptionWidget.static.highlightable=!0,p.ui.OutlineOptionWidget.static.scrollIntoViewOnSelect=!0,p.ui.OutlineOptionWidget.static.levelClass="oo-ui-outlineOptionWidget-level-",p.ui.OutlineOptionWidget.static.levels=3,p.ui.OutlineOptionWidget.prototype.isMovable=function(){return this.movable},p.ui.OutlineOptionWidget.prototype.isRemovable=function(){return this.removable},p.ui.OutlineOptionWidget.prototype.getLevel=function(){return this.level},p.ui.OutlineOptionWidget.prototype.setPressed=function(t){return p.ui.OutlineOptionWidget.parent.prototype.setPressed.call(this,t),this},p.ui.OutlineOptionWidget.prototype.setMovable=function(t){return this.movable=!!t,this.updateThemeClasses(),this},p.ui.OutlineOptionWidget.prototype.setRemovable=function(t){return this.removable=!!t,this.updateThemeClasses(),this},p.ui.OutlineOptionWidget.prototype.setSelected=function(t){return p.ui.OutlineOptionWidget.parent.prototype.setSelected.call(this,t),this},p.ui.OutlineOptionWidget.prototype.setLevel=function(t){var e=this.constructor.static.levels,i=this.constructor.static.levelClass,n=e;for(this.level=t?Math.max(0,Math.min(e-1,t)):0;n--;)this.level===n?this.$element.addClass(i+n):this.$element.removeClass(i+n);return this.updateThemeClasses(),this},p.ui.OutlineSelectWidget=function(t){p.ui.OutlineSelectWidget.parent.call(this,t),p.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-outlineSelectWidget")},p.inheritClass(p.ui.OutlineSelectWidget,p.ui.SelectWidget),p.mixinClass(p.ui.OutlineSelectWidget,p.ui.mixin.TabIndexedElement),p.ui.ButtonOptionWidget=function(t){t=t||{},p.ui.ButtonOptionWidget.parent.call(this,t),p.ui.mixin.ButtonElement.call(this,t),p.ui.mixin.IconElement.call(this,t),p.ui.mixin.IndicatorElement.call(this,t),p.ui.mixin.TitledElement.call(this,$.extend({},t,{$titled:this.$button})),this.$element.addClass("oo-ui-buttonOptionWidget"),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.append(this.$button)},p.inheritClass(p.ui.ButtonOptionWidget,p.ui.OptionWidget),p.mixinClass(p.ui.ButtonOptionWidget,p.ui.mixin.ButtonElement),p.mixinClass(p.ui.ButtonOptionWidget,p.ui.mixin.IconElement),p.mixinClass(p.ui.ButtonOptionWidget,p.ui.mixin.IndicatorElement),p.mixinClass(p.ui.ButtonOptionWidget,p.ui.mixin.TitledElement),p.ui.ButtonOptionWidget.static.cancelButtonMouseDownEvents=!1,p.ui.ButtonOptionWidget.static.highlightable=!1,p.ui.ButtonOptionWidget.prototype.setSelected=function(t){return p.ui.ButtonOptionWidget.parent.prototype.setSelected.call(this,t),this.constructor.static.selectable&&this.setActive(t),this},p.ui.ButtonSelectWidget=function(t){p.ui.ButtonSelectWidget.parent.call(this,t),p.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-buttonSelectWidget")},p.inheritClass(p.ui.ButtonSelectWidget,p.ui.SelectWidget),p.mixinClass(p.ui.ButtonSelectWidget,p.ui.mixin.TabIndexedElement),p.ui.TabOptionWidget=function(t){t=t||{},p.ui.TabOptionWidget.parent.call(this,t),this.$element.addClass("oo-ui-tabOptionWidget")},p.inheritClass(p.ui.TabOptionWidget,p.ui.OptionWidget),p.ui.TabOptionWidget.static.highlightable=!1,p.ui.TabSelectWidget=function(t){p.ui.TabSelectWidget.parent.call(this,t),p.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-tabSelectWidget")},p.inheritClass(p.ui.TabSelectWidget,p.ui.SelectWidget),p.mixinClass(p.ui.TabSelectWidget,p.ui.mixin.TabIndexedElement),p.ui.CapsuleItemWidget=function(t){t=t||{},p.ui.CapsuleItemWidget.parent.call(this,t),p.ui.mixin.ItemWidget.call(this),p.ui.mixin.LabelElement.call(this,t),p.ui.mixin.FlaggedElement.call(this,t),p.ui.mixin.TabIndexedElement.call(this,t),this.closeButton=new p.ui.ButtonWidget({framed:!1,icon:"close",tabIndex:-1,title:p.ui.msg("ooui-item-remove")}).on("click",this.onCloseClick.bind(this)),this.on("disable",function(t){this.closeButton.setDisabled(t)}.bind(this)),this.$element.on({click:this.onClick.bind(this),keydown:this.onKeyDown.bind(this)}).addClass("oo-ui-capsuleItemWidget").append(this.$label,this.closeButton.$element)},p.inheritClass(p.ui.CapsuleItemWidget,p.ui.Widget),p.mixinClass(p.ui.CapsuleItemWidget,p.ui.mixin.ItemWidget),p.mixinClass(p.ui.CapsuleItemWidget,p.ui.mixin.LabelElement),p.mixinClass(p.ui.CapsuleItemWidget,p.ui.mixin.FlaggedElement),p.mixinClass(p.ui.CapsuleItemWidget,p.ui.mixin.TabIndexedElement),p.ui.CapsuleItemWidget.prototype.onCloseClick=function(){var t=this.getElementGroup();t&&$.isFunction(t.removeItems)&&(t.removeItems([this]),t.focus())},p.ui.CapsuleItemWidget.prototype.onClick=function(){var t=this.getElementGroup();!this.isDisabled()&&t&&$.isFunction(t.editItem)&&t.editItem(this)},p.ui.CapsuleItemWidget.prototype.onKeyDown=function(t){var e=this.getElementGroup();return t.keyCode===p.ui.Keys.BACKSPACE||t.keyCode===p.ui.Keys.DELETE?(e.removeItems([this]),e.focus(),!1):t.keyCode===p.ui.Keys.ENTER?(e.editItem(this),!1):void(t.keyCode===p.ui.Keys.LEFT?e.getPreviousItem(this).focus():t.keyCode===p.ui.Keys.RIGHT&&e.getNextItem(this).focus())},p.ui.CapsuleMultiselectWidget=function(t){var e;p.ui.CapsuleMultiselectWidget.parent.call(this,t),t=$.extend({allowArbitrary:!1,allowDuplicates:!1},t),this.$handle=$("<div>"),this.$input=t.popup?null:$("<input>"),void 0!==t.placeholder&&""!==t.placeholder&&this.$input.attr("placeholder",t.placeholder),p.ui.mixin.GroupElement.call(this,t),t.popup?(t.popup=$.extend({},t.popup,{align:"forwards",anchor:!1}),p.ui.mixin.PopupElement.call(this,t),e=$("<span>"),p.ui.mixin.TabIndexedElement.call(this,$.extend({},t,{$tabIndexed:e}))):(this.popup=null,e=null,p.ui.mixin.TabIndexedElement.call(this,$.extend({},t,{$tabIndexed:this.$input}))),p.ui.mixin.IndicatorElement.call(this,t),p.ui.mixin.IconElement.call(this,t),this.$content=$("<div>"),this.allowArbitrary=t.allowArbitrary,this.allowDuplicates=t.allowDuplicates,this.$overlay=(!0===t.$overlay?p.ui.getDefaultOverlay():t.$overlay)||this.$element,this.menu=new p.ui.MenuSelectWidget($.extend({widget:this,$input:this.$input,$floatableContainer:this.$element,filterFromInput:!0,disabled:this.isDisabled()},t.menu)),this.popup?(e.on({focus:this.focus.bind(this)}),this.popup.$element.on("focusout",this.onPopupFocusOut.bind(this)),this.popup.$autoCloseIgnore&&this.popup.$autoCloseIgnore.on("focusout",this.onPopupFocusOut.bind(this)),this.popup.connect(this,{toggle:function(t){e.toggle(!t)}})):this.$input.on({focus:this.onInputFocus.bind(this),blur:this.onInputBlur.bind(this),"propertychange change click mouseup keydown keyup input cut paste select focus":p.ui.debounce(this.updateInputSize.bind(this)),keydown:this.onKeyDown.bind(this),keypress:this.onKeyPress.bind(this)}),this.menu.connect(this,{choose:"onMenuChoose",toggle:"onMenuToggle",add:"onMenuItemsChange",remove:"onMenuItemsChange"}),this.$handle.on({mousedown:this.onMouseDown.bind(this)}),this.$input&&(this.$input.prop("disabled",this.isDisabled()),this.$input.attr({role:"combobox","aria-owns":this.menu.getElementId(),"aria-autocomplete":"list"})),t.data&&this.setItemsFromData(t.data),this.$content.addClass("oo-ui-capsuleMultiselectWidget-content").append(this.$group),this.$group.addClass("oo-ui-capsuleMultiselectWidget-group"),this.$handle.addClass("oo-ui-capsuleMultiselectWidget-handle").append(this.$indicator,this.$icon,this.$content),this.$element.addClass("oo-ui-capsuleMultiselectWidget").append(this.$handle),this.popup?(this.popup.$element.addClass("oo-ui-capsuleMultiselectWidget-popup"),this.$content.append(e),this.$overlay.append(this.popup.$element)):(this.$content.append(this.$input),this.$overlay.append(this.menu.$element)),e&&e.addClass("oo-ui-capsuleMultiselectWidget-focusTrap"),setTimeout(function(){this.$input&&this.updateInputSize()}.bind(this)),this.onMenuItemsChange()},p.inheritClass(p.ui.CapsuleMultiselectWidget,p.ui.Widget),p.mixinClass(p.ui.CapsuleMultiselectWidget,p.ui.mixin.GroupElement),p.mixinClass(p.ui.CapsuleMultiselectWidget,p.ui.mixin.PopupElement),p.mixinClass(p.ui.CapsuleMultiselectWidget,p.ui.mixin.TabIndexedElement),p.mixinClass(p.ui.CapsuleMultiselectWidget,p.ui.mixin.IndicatorElement),p.mixinClass(p.ui.CapsuleMultiselectWidget,p.ui.mixin.IconElement),p.ui.CapsuleMultiselectWidget.prototype.createItemWidget=function(t,e){return""===e?null:new p.ui.CapsuleItemWidget({data:t,label:e})},p.ui.CapsuleMultiselectWidget.prototype.getInputId=function(){return this.$input?p.ui.mixin.TabIndexedElement.prototype.getInputId.call(this):null},p.ui.CapsuleMultiselectWidget.prototype.getItemsData=function(){return this.getItems().map(function(t){return t.data})},p.ui.CapsuleMultiselectWidget.prototype.setItemsFromData=function(t){var o=this,u=this.menu,l=this.getItems();return $.each(t,function(t,e){var i,n,s=u.findItemFromData(e);if(s)n=s.label;else{if(!o.allowArbitrary)return;n=String(e)}for(s=null,i=0;i<l.length;i++)if(l[i].data===e&&l[i].label===n){s=l[i],l.splice(i,1);break}s||(s=o.createItemWidget(e,n)),s&&o.addItems([s],t)}),l.length&&o.removeItems(l),this},p.ui.CapsuleMultiselectWidget.prototype.addItemsFromData=function(t){var n=this,s=this.menu,o=[];return $.each(t,function(t,e){var i;n.findItemFromData(e)&&!n.allowDuplicates||((i=s.findItemFromData(e))?i=n.createItemWidget(e,i.label):n.allowArbitrary&&(i=n.createItemWidget(e,String(e))),i&&o.push(i))}),o.length&&this.addItems(o),this},p.ui.CapsuleMultiselectWidget.prototype.addItemFromLabel=function(t){var e,i;return(e=this.menu.getItemFromLabel(t,!0))?(this.addItemsFromData([e.data]),!0):!!this.allowArbitrary&&(i=this.getItems(),this.addItemsFromData([t]),!p.compare(this.getItems(),i))},p.ui.CapsuleMultiselectWidget.prototype.removeItemsFromData=function(t){var n=this,s=[];return $.each(t,function(t,e){var i=n.findItemFromData(e);i&&s.push(i)}),s.length&&this.removeItems(s),this},p.ui.CapsuleMultiselectWidget.prototype.addItems=function(t){var e,i,n,s=this.items.slice();if(p.ui.mixin.GroupElement.prototype.addItems.call(this,t),this.items.length!==s.length)e=!1;else for(e=!0,i=0,n=s.length;e&&i<n;i++)e=e&&this.items[i]===s[i];return e||(this.emit("change",this.getItemsData()),this.updateInputSize()),this},p.ui.CapsuleMultiselectWidget.prototype.editItem=function(t){this.addItemFromLabel(this.$input.val()),this.clearInput(),this.$input.val(t.label),this.updateInputSize(),this.focus(),this.menu.updateItemVisibility(),this.removeItems([t])},p.ui.CapsuleMultiselectWidget.prototype.removeItems=function(t){var e,i,n,s=this.items.slice();if(p.ui.mixin.GroupElement.prototype.removeItems.call(this,t),this.items.length!==s.length)e=!1;else for(e=!0,i=0,n=s.length;e&&i<n;i++)e=e&&this.items[i]===s[i];return e||(this.emit("change",this.getItemsData()),this.updateInputSize()),this},p.ui.CapsuleMultiselectWidget.prototype.clearItems=function(){return this.items.length&&(p.ui.mixin.GroupElement.prototype.clearItems.call(this),this.emit("change",this.getItemsData()),this.updateInputSize()),this},p.ui.CapsuleMultiselectWidget.prototype.getNextItem=function(t){var e;return void 0===t?this.items[0]:!((e=this.items.indexOf(t))<0)&&(e===this.items.length-1?this.$input:this.items[e+1])},p.ui.CapsuleMultiselectWidget.prototype.getPreviousItem=function(t){var e;return void 0===t?this.items[this.items.length-1]:!((e=this.items.indexOf(t))<0)&&(0===e?this.$input:this.items[e-1])},p.ui.CapsuleMultiselectWidget.prototype.getMenu=function(){return this.menu},p.ui.CapsuleMultiselectWidget.prototype.onInputFocus=function(){this.isDisabled()||(this.updateInputSize(),this.menu.toggle(!0))},p.ui.CapsuleMultiselectWidget.prototype.onInputBlur=function(){this.addItemFromLabel(this.$input.val()),this.clearInput()},p.ui.CapsuleMultiselectWidget.prototype.onPopupFocusOut=function(){var t=this.popup;setTimeout(function(){t.isVisible()&&!p.ui.contains(t.$element.add(t.$autoCloseIgnore).get(),document.activeElement,!0)&&t.toggle(!1)})},p.ui.CapsuleMultiselectWidget.prototype.onMouseDown=function(t){if(t.which===p.ui.MouseButtons.LEFT)return this.focus(),!1;this.updateInputSize()},p.ui.CapsuleMultiselectWidget.prototype.onKeyPress=function(t){if(!this.isDisabled()){if(t.which===p.ui.Keys.ESCAPE)return this.clearInput(),!1;if(!this.popup){if(this.menu.toggle(!0),t.which===p.ui.Keys.ENTER)return this.addItemFromLabel(this.$input.val())&&this.clearInput(),!1;setTimeout(this.updateInputSize.bind(this),0)}}},p.ui.CapsuleMultiselectWidget.prototype.onKeyDown=function(t){if(!this.isDisabled()&&""===this.$input.val()&&this.items.length){if(t.keyCode===p.ui.Keys.BACKSPACE)return t.metaKey||t.ctrlKey?this.removeItems(this.items.slice(-1)):this.editItem(this.items[this.items.length-1]),!1;t.keyCode===p.ui.Keys.LEFT?this.getPreviousItem().focus():t.keyCode===p.ui.Keys.RIGHT&&this.getNextItem().focus()}},p.ui.CapsuleMultiselectWidget.prototype.updateInputSize=function(){var t,e,i,n;if(this.$input&&!this.isDisabled()){if(this.$input.css("width","1em"),t=this.$group.children().last(),e=p.ui.Element.static.getDir(this.$handle),void 0===this.contentWidthWithPlaceholder&&""===this.$input.val()&&void 0!==this.$input.attr("placeholder")&&(this.$input.val(this.$input.attr("placeholder")),this.contentWidthWithPlaceholder=this.$input[0].scrollWidth,this.$input.val("")),(i=Math.max(this.$input[0].scrollWidth,void 0===this.contentWidthWithPlaceholder?0:this.contentWidthWithPlaceholder))<this.$input.width())return void this.updateIfHeightChanged();n=0===t.length?this.$content.innerWidth():"ltr"===e?this.$content.innerWidth()-t.position().left-t.outerWidth():t.position().left,(n-=10)<i&&(n=this.$content.innerWidth()-10),this.$input.width(Math.floor(n)),this.updateIfHeightChanged()}else this.updateIfHeightChanged()},p.ui.CapsuleMultiselectWidget.prototype.updateIfHeightChanged=function(){var t=this.$element.height();t!==this.height&&(this.height=t,this.menu.position(),this.popup&&this.popup.updateDimensions(),this.emit("resize"))},p.ui.CapsuleMultiselectWidget.prototype.onMenuChoose=function(t){t&&t.isVisible()&&(this.addItemsFromData([t.getData()]),this.clearInput())},p.ui.CapsuleMultiselectWidget.prototype.onMenuToggle=function(t){this.$element.toggleClass("oo-ui-capsuleMultiselectWidget-open",t)},p.ui.CapsuleMultiselectWidget.prototype.onMenuItemsChange=function(){this.setItemsFromData(this.getItemsData()),this.$element.toggleClass("oo-ui-capsuleMultiselectWidget-empty",this.menu.isEmpty())},p.ui.CapsuleMultiselectWidget.prototype.clearInput=function(){this.$input&&(this.$input.val(""),this.updateInputSize()),this.popup&&this.popup.toggle(!1),this.menu.toggle(!1),this.menu.selectItem(),this.menu.highlightItem()},p.ui.CapsuleMultiselectWidget.prototype.setDisabled=function(t){var e,i;if(p.ui.CapsuleMultiselectWidget.parent.prototype.setDisabled.call(this,t),this.$input&&this.$input.prop("disabled",this.isDisabled()),this.menu&&this.menu.setDisabled(this.isDisabled()),this.popup&&this.popup.setDisabled(this.isDisabled()),this.items)for(e=0,i=this.items.length;e<i;e++)this.items[e].updateDisabled();return this},p.ui.CapsuleMultiselectWidget.prototype.focus=function(){return this.isDisabled()||(this.popup?(this.popup.setSize(this.$handle.outerWidth()),this.popup.toggle(!0),p.ui.findFocusable(this.popup.$element).focus()):p.ui.mixin.TabIndexedElement.prototype.focus.call(this)),this},p.ui.TagItemWidget=function(t){t=t||{},p.ui.TagItemWidget.parent.call(this,t),p.ui.mixin.ItemWidget.call(this),p.ui.mixin.LabelElement.call(this,t),p.ui.mixin.FlaggedElement.call(this,t),p.ui.mixin.TabIndexedElement.call(this,t),p.ui.mixin.DraggableElement.call(this,t),this.valid=void 0===t.valid||!!t.valid,this.closeButton=new p.ui.ButtonWidget({framed:!1,icon:"close",tabIndex:-1,title:p.ui.msg("ooui-item-remove")}),this.closeButton.setDisabled(this.isDisabled()),this.closeButton.connect(this,{click:"remove"}),this.$element.on("click",this.select.bind(this)).on("keydown",this.onKeyDown.bind(this)).on("mousedown",function(t){t.stopPropagation()}),this.$element.addClass("oo-ui-tagItemWidget").append(this.$label,this.closeButton.$element)},p.inheritClass(p.ui.TagItemWidget,p.ui.Widget),p.mixinClass(p.ui.TagItemWidget,p.ui.mixin.ItemWidget),p.mixinClass(p.ui.TagItemWidget,p.ui.mixin.LabelElement),p.mixinClass(p.ui.TagItemWidget,p.ui.mixin.FlaggedElement),p.mixinClass(p.ui.TagItemWidget,p.ui.mixin.TabIndexedElement),p.mixinClass(p.ui.TagItemWidget,p.ui.mixin.DraggableElement),p.ui.TagItemWidget.prototype.setDisabled=function(t){return p.ui.TagItemWidget.parent.prototype.setDisabled.call(this,t),this.closeButton&&this.closeButton.setDisabled(t),this.emit("disabled",this.isDisabled()),this},p.ui.TagItemWidget.prototype.remove=function(){this.isDisabled()||this.emit("remove")},p.ui.TagItemWidget.prototype.onKeyDown=function(t){var e;return!this.isDisabled()&&t.keyCode===p.ui.Keys.BACKSPACE||t.keyCode===p.ui.Keys.DELETE?(this.remove(),!1):t.keyCode===p.ui.Keys.ENTER?(this.select(),!1):t.keyCode===p.ui.Keys.LEFT||t.keyCode===p.ui.Keys.RIGHT?(e="rtl"===p.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"},this.emit("navigate",t.keyCode===p.ui.Keys.LEFT?e.left:e.right),!1):void 0},p.ui.TagItemWidget.prototype.select=function(){this.isDisabled()||this.emit("select")},p.ui.TagItemWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},p.ui.TagItemWidget.prototype.isValid=function(){return this.valid},p.ui.TagMultiselectWidget=function(t){var e,i=window.requestAnimationFrame||setTimeout,n=this,s=$("<span>").addClass("oo-ui-tagMultiselectWidget-focusTrap");t=t||{},p.ui.TagMultiselectWidget.parent.call(this,t),p.ui.mixin.GroupWidget.call(this,t),p.ui.mixin.IndicatorElement.call(this,t),p.ui.mixin.IconElement.call(this,t),p.ui.mixin.TabIndexedElement.call(this,t),p.ui.mixin.FlaggedElement.call(this,t),p.ui.mixin.DraggableGroupElement.call(this,t),this.toggleDraggable(void 0===t.allowReordering||!!t.allowReordering),this.inputPosition=-1<this.constructor.static.allowedInputPositions.indexOf(t.inputPosition)?t.inputPosition:"inline",this.allowEditTags=void 0===t.allowEditTags||!!t.allowEditTags,this.allowArbitrary=!!t.allowArbitrary,this.allowDuplicates=!!t.allowDuplicates,this.allowedValues=t.allowedValues||[],this.allowDisplayInvalidTags=t.allowDisplayInvalidTags,this.hasInput="none"!==this.inputPosition,this.height=null,this.valid=!0,this.$content=$("<div>").addClass("oo-ui-tagMultiselectWidget-content"),this.$handle=$("<div>").addClass("oo-ui-tagMultiselectWidget-handle").append(this.$indicator,this.$icon,this.$content.append(this.$group.addClass("oo-ui-tagMultiselectWidget-group"))),this.aggregate({remove:"itemRemove",navigate:"itemNavigate",select:"itemSelect",disabled:"itemDisabled"}),this.connect(this,{itemRemove:"onTagRemove",itemSelect:"onTagSelect",itemDisabled:"onTagDisabled",itemNavigate:"onTagNavigate",change:"onChangeTags"}),this.$handle.on({mousedown:this.onMouseDown.bind(this)}),this.$element.addClass("oo-ui-tagMultiselectWidget").append(this.$handle),this.hasInput?(t.inputWidget?this.input=t.inputWidget:this.input=new p.ui.TextInputWidget($.extend({placeholder:t.placeholder,classes:["oo-ui-tagMultiselectWidget-input"]},t.input)),this.input.setDisabled(this.isDisabled()),e={focus:this.onInputFocus.bind(this),blur:this.onInputBlur.bind(this),"propertychange change click mouseup keydown keyup input cut paste select focus":p.ui.debounce(this.updateInputSize.bind(this)),keydown:this.onInputKeyDown.bind(this),keypress:this.onInputKeyPress.bind(this)},this.input.$input.on(e),"outline"===this.inputPosition?(this.input.$element.css("max-width","inherit"),this.$element.addClass("oo-ui-tagMultiselectWidget-outlined").append(this.input.$element)):(this.$element.addClass("oo-ui-tagMultiselectWidget-inlined"),this.$content.append(this.input.$input))):this.$content.append(s),this.setTabIndexedElement(this.hasInput?this.input.$input:s),t.selected&&this.setValue(t.selected),i(function(){n.hasInput&&n.updateInputSize()})},p.inheritClass(p.ui.TagMultiselectWidget,p.ui.Widget),p.mixinClass(p.ui.TagMultiselectWidget,p.ui.mixin.GroupWidget),p.mixinClass(p.ui.TagMultiselectWidget,p.ui.mixin.DraggableGroupElement),p.mixinClass(p.ui.TagMultiselectWidget,p.ui.mixin.IndicatorElement),p.mixinClass(p.ui.TagMultiselectWidget,p.ui.mixin.IconElement),p.mixinClass(p.ui.TagMultiselectWidget,p.ui.mixin.TabIndexedElement),p.mixinClass(p.ui.TagMultiselectWidget,p.ui.mixin.FlaggedElement),p.ui.TagMultiselectWidget.static.allowedInputPositions=["inline","outline","none"],p.ui.TagMultiselectWidget.prototype.onMouseDown=function(t){if(!(this.isDisabled()||this.hasInput&&t.target===this.input.$input[0]||t.which!==p.ui.MouseButtons.LEFT))return this.focus(),!1},p.ui.TagMultiselectWidget.prototype.onInputKeyPress=function(t){var e,i=t.metaKey||t.ctrlKey;if(!this.isDisabled())return t.which===p.ui.Keys.ENTER&&(e=this.doInputEnter(t,i)),setTimeout(this.updateInputSize.bind(this),0),e},p.ui.TagMultiselectWidget.prototype.onInputKeyDown=function(t){var e,i,n,s,o,u=this,l=t.metaKey||t.ctrlKey;if(!this.isDisabled()){if(t.keyCode===p.ui.Keys.BACKSPACE)return this.doInputBackspace(t,l);if(t.keyCode===p.ui.Keys.ESCAPE)return this.doInputEscape(t);if((t.keyCode===p.ui.Keys.LEFT||t.keyCode===p.ui.Keys.RIGHT)&&(e="rtl"===p.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"},i=t.keyCode===p.ui.Keys.LEFT?e.left:e.right,!this.hasInput||(n=i,s=u.input.getRange(),o=u.hasInput&&u.input.getValue(),"forwards"===n&&s.to>o.length-1||"backwards"===n&&s.from<=0)))return this.doInputArrow(t,i,l)}},p.ui.TagMultiselectWidget.prototype.onInputFocus=function(){this.$element.addClass("oo-ui-tagMultiselectWidget-focus")},p.ui.TagMultiselectWidget.prototype.onInputBlur=function(){this.$element.removeClass("oo-ui-tagMultiselectWidget-focus")},p.ui.TagMultiselectWidget.prototype.doInputEnter=function(){return this.addTagFromInput(),!1},p.ui.TagMultiselectWidget.prototype.doInputBackspace=function(t,e){var i,n;if("inline"===this.inputPosition&&""===this.input.getValue()&&!this.isEmpty())return(n=(i=this.getItems())[i.length-1]).isDisabled()||(this.removeItems([n]),e||this.input.setValue(n.getData())),!1},p.ui.TagMultiselectWidget.prototype.doInputEscape=function(){this.clearInput()},p.ui.TagMultiselectWidget.prototype.doInputArrow=function(t,e){"inline"!==this.inputPosition||this.isEmpty()||"backwards"!==e||this.getPreviousItem().focus()},p.ui.TagMultiselectWidget.prototype.onTagSelect=function(t){this.hasInput&&this.allowEditTags&&(this.input.getValue()&&this.addTagFromInput(),this.input.setValue(t.getData()),this.removeItems([t]),this.focus())},p.ui.TagMultiselectWidget.prototype.onTagDisabled=function(t,e){e&&this.addItems(t,0)},p.ui.TagMultiselectWidget.prototype.onChangeTags=function(){this.toggleValid(this.checkValidity()),this.hasInput&&this.updateInputSize(),this.updateIfHeightChanged()},p.ui.TagMultiselectWidget.prototype.setDisabled=function(e){p.ui.TagMultiselectWidget.parent.prototype.setDisabled.call(this,e),this.hasInput&&this.input&&this.input.setDisabled(!!e),this.items&&this.getItems().forEach(function(t){t.setDisabled(!!e)})},p.ui.TagMultiselectWidget.prototype.onTagRemove=function(t){this.removeTagByData(t.getData())},p.ui.TagMultiselectWidget.prototype.onTagNavigate=function(t,e){var i=this.getItems()[0];"forwards"===e?this.getNextItem(t).focus():"inline"!==!this.inputPosition&&t===i||this.getPreviousItem(t).focus()},p.ui.TagMultiselectWidget.prototype.addTagFromInput=function(){var t=this.input.getValue(),e=this.isAllowedData(t);t&&(e||this.allowDisplayInvalidTags)&&(this.addTag(t),this.clearInput(),this.focus())},p.ui.TagMultiselectWidget.prototype.clearInput=function(){this.input.setValue("")},p.ui.TagMultiselectWidget.prototype.isDuplicateData=function(t){return!!this.findItemFromData(t)},p.ui.TagMultiselectWidget.prototype.isAllowedData=function(e){return!(!this.allowDuplicates&&this.isDuplicateData(e))&&(!!this.allowArbitrary||!!this.getAllowedValues().some(function(t){return e===t}))},p.ui.TagMultiselectWidget.prototype.getAllowedValues=function(){return this.allowedValues},p.ui.TagMultiselectWidget.prototype.addAllowedValue=function(t){-1===this.allowedValues.indexOf(t)&&this.allowedValues.push(t)},p.ui.TagMultiselectWidget.prototype.getValue=function(){return this.getItems().filter(function(t){return t.isValid()}).map(function(t){return t.getData()})},p.ui.TagMultiselectWidget.prototype.setValue=function(t){t=Array.isArray(t)?t:[t],this.clearItems(),t.forEach(function(t){"string"==typeof t?this.addTag(t):this.addTag(t.data,t.label)}.bind(this))},p.ui.TagMultiselectWidget.prototype.addTag=function(t,e){var i,n=this.isAllowedData(t);return!(!n&&!this.allowDisplayInvalidTags)&&((i=this.createTagItemWidget(t,e)).toggleValid(n),this.addItems([i]),!0)},p.ui.TagMultiselectWidget.prototype.removeTagByData=function(t){var e=this.findItemFromData(t);this.removeItems([e])},p.ui.TagMultiselectWidget.prototype.createTagItemWidget=function(t,e){return e=e||t,new p.ui.TagItemWidget({data:t,label:e})},p.ui.TagMultiselectWidget.prototype.getNextItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[0]:e===this.items.length-1?this.hasInput?this.input:this.items[0]:this.items[e+1]},p.ui.TagMultiselectWidget.prototype.getPreviousItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[this.items.length-1]:0===e?this.hasInput?this.input:this.items[this.items.length-1]:this.items[e-1]},p.ui.TagMultiselectWidget.prototype.updateInputSize=function(){var t,e,i,n;if("inline"!==this.inputPosition||this.isDisabled())this.updateIfHeightChanged();else{if(0===this.input.$input[0].scrollWidth)return;if(this.input.$input.css("width","1em"),t=this.$group.children().last(),e=p.ui.Element.static.getDir(this.$handle),void 0===this.contentWidthWithPlaceholder&&""===this.input.getValue()&&void 0!==this.input.$input.attr("placeholder")&&(this.input.setValue(this.input.$input.attr("placeholder")),this.contentWidthWithPlaceholder=this.input.$input[0].scrollWidth,this.input.setValue("")),(i=Math.max(this.input.$input[0].scrollWidth,void 0===this.contentWidthWithPlaceholder?0:this.contentWidthWithPlaceholder))<this.input.$input.width())return void this.updateIfHeightChanged();n=0===t.length?this.$content.innerWidth():"ltr"===e?this.$content.innerWidth()-t.position().left-t.outerWidth():t.position().left,(n-=10)<i&&(n=this.$content.innerWidth()-10),this.input.$input.width(Math.floor(n)),this.updateIfHeightChanged()}},p.ui.TagMultiselectWidget.prototype.updateIfHeightChanged=function(){var t=this.$element.height();t!==this.height&&(this.height=t,this.emit("resize"))},p.ui.TagMultiselectWidget.prototype.checkValidity=function(){return this.getItems().every(function(t){return t.isValid()})},p.ui.TagMultiselectWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},p.ui.TagMultiselectWidget.prototype.isValid=function(){return this.valid},p.ui.PopupTagMultiselectWidget=function(t){var e,i={popup:{}};t=t||{},p.ui.PopupTagMultiselectWidget.parent.call(this,$.extend({inputPosition:"none"},t)),this.$overlay=(!0===t.$overlay?p.ui.getDefaultOverlay():t.$overlay)||this.$element,t.popup||(e=new p.ui.TextInputWidget,i.popupInput=e,i.popup.$content=e.$element,i.popup.padded=!0,this.$element.addClass("oo-ui-popupTagMultiselectWidget-defaultPopup")),i.popup.$overlay=this.$overlay,i.popup.$autoCloseIgnore=this.hasInput?this.input.$element.add(this.$overlay):this.$overlay,t=$.extend(i,t),p.ui.mixin.PopupElement.call(this,t),this.hasInput&&this.input.$input.on("focus",this.popup.toggle.bind(this.popup,!0)),this.popupInput=t.popupInput,this.popupInput&&this.popupInput.connect(this,{enter:"onPopupInputEnter"}),this.on("resize",this.popup.updateDimensions.bind(this.popup)),this.popup.connect(this,{toggle:"onPopupToggle"}),this.$tabIndexed.on("focus",this.onFocus.bind(this)),this.$element.append(this.popup.$element).addClass("oo-ui-popupTagMultiselectWidget")},p.inheritClass(p.ui.PopupTagMultiselectWidget,p.ui.TagMultiselectWidget),p.mixinClass(p.ui.PopupTagMultiselectWidget,p.ui.mixin.PopupElement),p.ui.PopupTagMultiselectWidget.prototype.onFocus=function(){this.popup.toggle(!0)},p.ui.PopupTagMultiselectWidget.prototype.onPopupToggle=function(t){t&&this.popupInput&&this.popupInput.focus()},p.ui.PopupTagMultiselectWidget.prototype.onPopupInputEnter=function(){this.popupInput&&(this.addTagByPopupValue(this.popupInput.getValue()),this.popupInput.setValue(""))},p.ui.PopupTagMultiselectWidget.prototype.onTagSelect=function(t){this.popupInput&&this.allowEditTags?(this.popupInput.setValue(t.getData()),this.removeItems([t]),this.popup.toggle(!0),this.popupInput.focus()):p.ui.PopupTagMultiselectWidget.parent.prototype.onTagSelect.call(this,t)},p.ui.PopupTagMultiselectWidget.prototype.addTagByPopupValue=function(t,e){this.addTag(t,e)},p.ui.MenuTagMultiselectWidget=function(t){t=t||{},p.ui.MenuTagMultiselectWidget.parent.call(this,t),this.$overlay=(!0===t.$overlay?p.ui.getDefaultOverlay():t.$overlay)||this.$element,this.clearInputOnChoose=void 0===t.clearInputOnChoose||!!t.clearInputOnChoose,this.menu=this.createMenuWidget($.extend({widget:this,input:this.hasInput?this.input:null,$input:this.hasInput?this.input.$input:null,filterFromInput:!!this.hasInput,$autoCloseIgnore:this.hasInput?this.input.$element:$([]),$floatableContainer:this.hasInput&&"outline"===this.inputPosition?this.input.$element:this.$element,$overlay:this.$overlay,disabled:this.isDisabled()},t.menu)),this.addOptions(t.options||[]),this.menu.connect(this,{choose:"onMenuChoose",toggle:"onMenuToggle"}),this.hasInput&&this.input.connect(this,{change:"onInputChange"}),this.connect(this,{resize:"onResize"}),this.$overlay.append(this.menu.$element),this.$element.addClass("oo-ui-menuTagMultiselectWidget"),t.selected&&this.setValue(t.selected)},p.inheritClass(p.ui.MenuTagMultiselectWidget,p.ui.TagMultiselectWidget),p.ui.MenuTagMultiselectWidget.prototype.onResize=function(){this.menu.position()},p.ui.MenuTagMultiselectWidget.prototype.onInputFocus=function(){p.ui.MenuTagMultiselectWidget.parent.prototype.onInputFocus.call(this),this.menu.toggle(!0)},p.ui.MenuTagMultiselectWidget.prototype.onInputChange=function(){this.menu.toggle(!0),this.initializeMenuSelection()},p.ui.MenuTagMultiselectWidget.prototype.onMenuChoose=function(t){this.addTag(t.getData(),t.getLabel()),this.hasInput&&this.clearInputOnChoose&&this.input.setValue("")},p.ui.MenuTagMultiselectWidget.prototype.onMenuToggle=function(t){t?this.initializeMenuSelection():(this.menu.selectItem(null),this.menu.highlightItem(null))},p.ui.MenuTagMultiselectWidget.prototype.onTagSelect=function(t){var e=this.menu.findItemFromData(t.getData());this.hasInput&&this.menu.filterFromInput&&this.input.setValue(""),this.menu.selectItem(e),this.focus()},p.ui.MenuTagMultiselectWidget.prototype.initializeMenuSelection=function(){this.menu.findSelectedItem()||this.menu.highlightItem(this.menu.findFirstSelectableItem())},p.ui.MenuTagMultiselectWidget.prototype.addTagFromInput=function(){var t=this.input.getValue(),e=this.menu.findHighlightedItem(),i=this.menu.findItemFromData(t);t&&(e?this.addTag(e.getData(),e.getLabel()):i?this.addTag(i.getData(),i.getLabel()):this.addTag(t))&&(this.clearInput(),this.focus())},p.ui.MenuTagMultiselectWidget.prototype.getMenuVisibleItems=function(){return this.menu.getItems().filter(function(t){return t.isVisible()})},p.ui.MenuTagMultiselectWidget.prototype.createMenuWidget=function(t){return new p.ui.MenuSelectWidget(t)},p.ui.MenuTagMultiselectWidget.prototype.addOptions=function(t){var e=this,i=t.map(function(t){return e.createMenuOptionWidget(t.data,t.label)});this.menu.addItems(i)},p.ui.MenuTagMultiselectWidget.prototype.createMenuOptionWidget=function(t,e){return new p.ui.MenuOptionWidget({data:t,label:e||t})},p.ui.MenuTagMultiselectWidget.prototype.getMenu=function(){return this.menu},p.ui.MenuTagMultiselectWidget.prototype.getAllowedValues=function(){var t=[];return this.menu&&(t=this.menu.getItems().map(function(t){return t.getData()})),this.allowedValues.concat(t)},p.ui.SelectFileWidget=function(t){var e;t=$.extend({accept:null,placeholder:p.ui.msg("ooui-selectfile-placeholder"),notsupported:p.ui.msg("ooui-selectfile-not-supported"),droppable:!0,showDropTarget:!1,thumbnailSizeLimit:20},t),p.ui.SelectFileWidget.parent.call(this,t),p.ui.mixin.IconElement.call(this,t),p.ui.mixin.IndicatorElement.call(this,t),p.ui.mixin.PendingElement.call(this,$.extend({},t,{$pending:this.$info})),p.ui.mixin.LabelElement.call(this,t),this.$info=$("<span>"),this.showDropTarget=t.showDropTarget,this.thumbnailSizeLimit=t.thumbnailSizeLimit,this.isSupported=this.constructor.static.isSupported(),this.currentFile=null,Array.isArray(t.accept)?this.accept=t.accept:this.accept=null,this.placeholder=t.placeholder,this.notsupported=t.notsupported,this.onFileSelectedHandler=this.onFileSelected.bind(this),this.selectButton=new p.ui.ButtonWidget({classes:["oo-ui-selectFileWidget-selectButton"],label:p.ui.msg("ooui-selectfile-button-select"),disabled:this.disabled||!this.isSupported}),this.clearButton=new p.ui.ButtonWidget({classes:["oo-ui-selectFileWidget-clearButton"],framed:!1,icon:"close",disabled:this.disabled}),this.selectButton.$button.on({keypress:this.onKeyPress.bind(this)}),this.clearButton.connect(this,{click:"onClearClick"}),t.droppable&&(e=this.onDragEnterOrOver.bind(this),this.$element.on({dragenter:e,dragover:e,dragleave:this.onDragLeave.bind(this),drop:this.onDrop.bind(this)})),this.addInput(),this.$label.addClass("oo-ui-selectFileWidget-label"),this.$info.addClass("oo-ui-selectFileWidget-info").append(this.$icon,this.$label,this.clearButton.$element,this.$indicator),t.droppable&&t.showDropTarget?(this.selectButton.setIcon("upload"),this.$thumbnail=$("<div>").addClass("oo-ui-selectFileWidget-thumbnail"),this.setPendingElement(this.$thumbnail),this.$element.addClass("oo-ui-selectFileWidget-dropTarget oo-ui-selectFileWidget").on({click:this.onDropTargetClick.bind(this)}).append(this.$thumbnail,this.$info,this.selectButton.$element,$("<span>").addClass("oo-ui-selectFileWidget-dropLabel").text(p.ui.msg("ooui-selectfile-dragdrop-placeholder")))):this.$element.addClass("oo-ui-selectFileWidget").append(this.$info,this.selectButton.$element),this.updateUI()},p.inheritClass(p.ui.SelectFileWidget,p.ui.Widget),p.mixinClass(p.ui.SelectFileWidget,p.ui.mixin.IconElement),p.mixinClass(p.ui.SelectFileWidget,p.ui.mixin.IndicatorElement),p.mixinClass(p.ui.SelectFileWidget,p.ui.mixin.PendingElement),p.mixinClass(p.ui.SelectFileWidget,p.ui.mixin.LabelElement),p.ui.SelectFileWidget.static.isSupported=function(){var t;return null===p.ui.SelectFileWidget.static.isSupportedCache&&(t=$("<input>").attr("type","file"),p.ui.SelectFileWidget.static.isSupportedCache=void 0!==t[0].files),p.ui.SelectFileWidget.static.isSupportedCache},p.ui.SelectFileWidget.static.isSupportedCache=null,p.ui.SelectFileWidget.prototype.getValue=function(){return this.currentFile},p.ui.SelectFileWidget.prototype.setValue=function(t){this.currentFile!==t&&(this.currentFile=t,this.updateUI(),this.emit("change",this.currentFile))},p.ui.SelectFileWidget.prototype.focus=function(){return this.selectButton.focus(),this},p.ui.SelectFileWidget.prototype.blur=function(){return this.selectButton.blur(),this},p.ui.SelectFileWidget.prototype.simulateLabelClick=function(){this.focus()},p.ui.SelectFileWidget.prototype.updateUI=function(){var t;this.isSupported?(this.$element.addClass("oo-ui-selectFileWidget-supported"),this.currentFile?(this.$element.removeClass("oo-ui-selectFileWidget-empty"),t=(t=$([])).add($("<span>").addClass("oo-ui-selectFileWidget-fileName").text(this.currentFile.name)),this.setLabel(t),this.showDropTarget&&(this.pushPending(),this.loadAndGetImageUrl().done(function(t){this.$thumbnail.css("background-image","url( "+t+" )")}.bind(this)).fail(function(){this.$thumbnail.append(new p.ui.IconWidget({icon:"attachment",classes:["oo-ui-selectFileWidget-noThumbnail-icon"]}).$element)}.bind(this)).always(function(){this.popPending()}.bind(this)),this.$element.off("click"))):(this.showDropTarget&&(this.$element.off("click"),this.$element.on({click:this.onDropTargetClick.bind(this)}),this.$thumbnail.empty().css("background-image","")),this.$element.addClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.placeholder))):(this.$element.addClass("oo-ui-selectFileWidget-notsupported"),this.$element.removeClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.notsupported))},p.ui.SelectFileWidget.prototype.loadAndGetImageUrl=function(){var i=$.Deferred(),t=this.currentFile,e=new FileReader;return t&&0===(p.getProp(t,"type")||"").indexOf("image/")&&t.size<1024*this.thumbnailSizeLimit*1024?(e.onload=function(t){var e=document.createElement("img");e.addEventListener("load",function(){0===e.naturalWidth||0===e.naturalHeight||!1===e.complete?i.reject():i.resolve(t.target.result)}),e.src=t.target.result},e.readAsDataURL(t)):i.reject(),i.promise()},p.ui.SelectFileWidget.prototype.addInput=function(){this.$input&&this.$input.remove(),this.isSupported?(this.$input=$("<input>").attr("type","file"),this.$input.on("change",this.onFileSelectedHandler),this.$input.on("click",function(t){t.stopPropagation()}),this.$input.attr({tabindex:-1}),this.accept&&this.$input.attr("accept",this.accept.join(", ")),this.selectButton.$button.append(this.$input)):this.$input=null},p.ui.SelectFileWidget.prototype.isAllowedType=function(t){var e,i;if(!this.accept||!t)return!0;for(e=0;e<this.accept.length;e++){if((i=this.accept[e])===t)return!0;if("/*"===i.substr(-2)&&(i=i.substr(0,i.length-1),t.substr(0,i.length)===i))return!0}return!1},p.ui.SelectFileWidget.prototype.onFileSelected=function(t){var e=p.getProp(t.target,"files",0)||null;e&&!this.isAllowedType(e.type)&&(e=null),this.setValue(e),this.addInput()},p.ui.SelectFileWidget.prototype.onClearClick=function(){return this.setValue(null),!1},p.ui.SelectFileWidget.prototype.onKeyPress=function(t){if(this.isSupported&&!this.isDisabled()&&this.$input&&(t.which===p.ui.Keys.SPACE||t.which===p.ui.Keys.ENTER))return this.$input.click(),!1},p.ui.SelectFileWidget.prototype.onDropTargetClick=function(){if(this.isSupported&&!this.isDisabled()&&this.$input)return this.$input.click(),!1},p.ui.SelectFileWidget.prototype.onDragEnterOrOver=function(t){var e,i=!1,n=t.originalEvent.dataTransfer;return t.preventDefault(),t.stopPropagation(),this.isDisabled()||!this.isSupported?(this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),!(n.dropEffect="none")):((e=p.getProp(n,"items",0)||p.getProp(n,"files",0))?this.isAllowedType(e.type)&&(i=!0):-1!==Array.prototype.indexOf.call(p.getProp(n,"types")||[],"Files")&&(i=!0),this.$element.toggleClass("oo-ui-selectFileWidget-canDrop",i),i||(n.dropEffect="none"),!1)},p.ui.SelectFileWidget.prototype.onDragLeave=function(){this.$element.removeClass("oo-ui-selectFileWidget-canDrop")},p.ui.SelectFileWidget.prototype.onDrop=function(t){var e=null,i=t.originalEvent.dataTransfer;return t.preventDefault(),t.stopPropagation(),this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),this.isDisabled()||!this.isSupported||((e=p.getProp(i,"files",0))&&!this.isAllowedType(e.type)&&(e=null),e&&this.setValue(e)),!1},p.ui.SelectFileWidget.prototype.setDisabled=function(t){return p.ui.SelectFileWidget.parent.prototype.setDisabled.call(this,t),this.selectButton&&this.selectButton.setDisabled(t),this.clearButton&&this.clearButton.setDisabled(t),this},p.ui.SearchWidget=function(t){t=t||{},p.ui.SearchWidget.parent.call(this,t),this.query=new p.ui.TextInputWidget({icon:"search",placeholder:t.placeholder,value:t.value}),this.results=new p.ui.SelectWidget,this.$query=$("<div>"),this.$results=$("<div>"),this.query.connect(this,{change:"onQueryChange",enter:"onQueryEnter"}),this.query.$input.on("keydown",this.onQueryKeydown.bind(this)),this.$query.addClass("oo-ui-searchWidget-query").append(this.query.$element),this.$results.addClass("oo-ui-searchWidget-results").append(this.results.$element),this.$element.addClass("oo-ui-searchWidget").append(this.$results,this.$query)},p.inheritClass(p.ui.SearchWidget,p.ui.Widget),p.ui.SearchWidget.prototype.onQueryKeydown=function(t){var e,i,n=t.which===p.ui.Keys.DOWN?1:t.which===p.ui.Keys.UP?-1:0;n&&((e=this.results.findHighlightedItem())||(e=this.results.findSelectedItem()),i=this.results.findRelativeSelectableItem(e,n),this.results.highlightItem(i),i.scrollElementIntoView())},p.ui.SearchWidget.prototype.onQueryChange=function(){this.results.clearItems()},p.ui.SearchWidget.prototype.onQueryEnter=function(){var t=this.results.findHighlightedItem();t&&this.results.chooseItem(t)},p.ui.SearchWidget.prototype.getQuery=function(){return this.query},p.ui.SearchWidget.prototype.getResults=function(){return this.results},p.ui.NumberInputWidget=function(t){var e=$("<div>").addClass("oo-ui-numberInputWidget-field");t=$.extend({allowInteger:!1,min:-1/0,max:1/0,step:1,pageStep:null,showButtons:!0},t),$.extend(t,t.input),this.input=this,p.ui.NumberInputWidget.parent.call(this,$.extend(t,{type:"number"})),t.showButtons&&(this.minusButton=new p.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-minusButton"],icon:"subtract"},t.minusButton)),this.plusButton=new p.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-plusButton"],icon:"add"},t.plusButton))),this.$input.on({keydown:this.onKeyDown.bind(this),"wheel mousewheel DOMMouseScroll":this.onWheel.bind(this)}),t.showButtons&&(this.plusButton.connect(this,{click:["onButtonClick",1]}),this.minusButton.connect(this,{click:["onButtonClick",-1]})),e.append(this.$input),t.showButtons&&e.prepend(this.minusButton.$element).append(this.plusButton.$element),this.setAllowInteger(t.allowInteger||t.isInteger),this.setRange(t.min,t.max),this.setStep(t.step,t.pageStep),this.setValidation(this.validateNumber.bind(this)),this.$element.addClass("oo-ui-numberInputWidget").toggleClass("oo-ui-numberInputWidget-buttoned",t.showButtons).append(e)},p.inheritClass(p.ui.NumberInputWidget,p.ui.TextInputWidget),p.ui.NumberInputWidget.prototype.setAllowInteger=function(t){this.allowInteger=!!t,this.setValidityFlag()},p.ui.NumberInputWidget.prototype.setIsInteger=p.ui.NumberInputWidget.prototype.setAllowInteger,p.ui.NumberInputWidget.prototype.getAllowInteger=function(){return this.allowInteger},p.ui.NumberInputWidget.prototype.getIsInteger=p.ui.NumberInputWidget.prototype.getAllowInteger,p.ui.NumberInputWidget.prototype.setRange=function(t,e){if(e<t)throw new Error("Minimum ("+t+") must not be greater than maximum ("+e+")");this.min=t,this.max=e,this.setValidityFlag()},p.ui.NumberInputWidget.prototype.getRange=function(){return[this.min,this.max]},p.ui.NumberInputWidget.prototype.setStep=function(t,e){if(t<=0)throw new Error("Step value must be positive");if(null===e)e=10*t;else if(e<=0)throw new Error("Page step value must be positive");this.step=t,this.pageStep=e},p.ui.NumberInputWidget.prototype.setValue=function(t){return""===t&&this.$input.val(""),p.ui.NumberInputWidget.parent.prototype.setValue.call(this,t)},p.ui.NumberInputWidget.prototype.getStep=function(){return[this.step,this.pageStep]},p.ui.NumberInputWidget.prototype.getNumericValue=function(){return+this.getValue()},p.ui.NumberInputWidget.prototype.adjustValue=function(t){var e,i=this.getNumericValue();if(t=+t,isNaN(t)||!isFinite(t))throw new Error("Delta must be a finite number");isNaN(i)?e=0:(e=i+t,e=Math.max(Math.min(e,this.max),this.min),this.allowInteger&&(e=Math.round(e))),e!==i&&this.setValue(e)},p.ui.NumberInputWidget.prototype.validateNumber=function(t){var e=+t;return""===t?!this.isRequired():!(isNaN(e)||!isFinite(e))&&((!this.allowInteger||Math.floor(e)===e)&&!(e<this.min||e>this.max))},p.ui.NumberInputWidget.prototype.onButtonClick=function(t){this.adjustValue(t*this.step)},p.ui.NumberInputWidget.prototype.onWheel=function(t){var e=0;if(!this.isDisabled()&&this.$input.is(":focus"))return void 0!==t.originalEvent.deltaMode&&(this.sawWheelEvent=!0),t.originalEvent.deltaY?e=-t.originalEvent.deltaY:t.originalEvent.deltaX&&(e=t.originalEvent.deltaX),this.sawWheelEvent||(t.originalEvent.wheelDeltaX?e=-t.originalEvent.wheelDeltaX:t.originalEvent.wheelDeltaY?e=t.originalEvent.wheelDeltaY:t.originalEvent.wheelDelta?e=t.originalEvent.wheelDelta:t.originalEvent.detail&&(e=-t.originalEvent.detail)),e&&(e=e<0?-1:1,this.adjustValue(e*this.step)),!1},p.ui.NumberInputWidget.prototype.onKeyDown=function(t){if(!this.isDisabled())switch(t.which){case p.ui.Keys.UP:return this.adjustValue(this.step),!1;case p.ui.Keys.DOWN:return this.adjustValue(-this.step),!1;case p.ui.Keys.PAGEUP:return this.adjustValue(this.pageStep),!1;case p.ui.Keys.PAGEDOWN:return this.adjustValue(-this.pageStep),!1}},p.ui.NumberInputWidget.prototype.setDisabled=function(t){return p.ui.NumberInputWidget.parent.prototype.setDisabled.call(this,t),this.minusButton&&this.minusButton.setDisabled(this.isDisabled()),this.plusButton&&this.plusButton.setDisabled(this.isDisabled()),this}}(OO);
//# sourceMappingURL=oojs-ui-widgets.min.js.map